@校内を散策する
#DIM DYNAMIC LCOUNT
#DIM DYNAMIC LRESULT

PRINTFORML □%CALLNAME:PLAYER%は学校内を散策してみた
VARSET 出現率
CALL 出現キャラ_学校
FOR LCOUNT, 1, CHARANUM
	IF RANDPER(出現率:LCOUNT)
		PRINTFORM 　[{LCOUNT}] - 
		CALL SNAME(LCOUNT, 1)
		PRINTL に話しかける
	ENDIF
NEXT
DRAWLINE
PRINTPLAIN 　校内を散策する　
PRINTFORML [0] - 戻る [-1] - もう少し周りを見てみる

BINPUT
LRESULT = RESULT
SELECTCASE LRESULT
	CASE 0
		RETURN 0
	CASE -1
		RESTART
	CASEELSE
		SIF 授業中
			授業参加フラグ = 1
		CALL 学園モード_汎用会話, LRESULT
		IF !RESULT
			授業参加フラグ = 0
			RESTART
		ENDIF
ENDSELECT

RETURN 1

@出現キャラ_学校
#DIM DYNAMIC LCOUNT

;NOではなく登録番号で指定する
FOR LCOUNT, 1, CHARANUM
	;同じ学校に居るキャラのみ
	SIF CSTR:PLAYER:現在地 != CSTR:LCOUNT:現在地
		CONTINUE
	IF 運命の人 == NAME:LCOUNT
		出現率:LCOUNT = 50
	ELSE
		出現率:LCOUNT = 10
	ENDIF
NEXT

;;;校内に居るフラグ
@校内
#FUNCTION

SIF CSTR:PLAYER:現在地 == CSTR:PLAYER:在校
	RETURNF 1
RETURNF 0
