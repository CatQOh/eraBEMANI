;-----------------------------------------------------------------------------------------
;首絞め派生
;-------------------------------------------------
@USERCOM_ABLE_正常位首絞め
#FUNCTION

;首絞めのABLE
SIF !USERCOM_ABLE_首を絞める()
	COMRESULT = 0

;前コマンドが正常位なら派生可能
コマンド実行条件 += "前回と今回の実行者が同じで、正常位から派生可能/"
IF TFLAG:前コマンド実行者 == PLAYER
	SIF PREVPOSITIONS == "正常位"
		RETURNF COMRESULT
ENDIF

COMRESULT = 0
RETURNF 0

@COM_正常位首絞め
PRINTL 正常位首絞め
CALL KOJO_MESSAGE_COM

CALL STRANGLE_PLAYERS, 1000
CALL STRANGLE_TARGETS, 200

;-------------------------------------------------
;ソース追加処理
;-------------------------------------------------
;消費体力、気力
LOSEBASE:体力 += 90
LOSEBASE:気力 += 550

DOWNBASE:MASTER:体力 += 80
DOWNBASE:MASTER:気力 += 90

SOURCE:快V = 400
SOURCE:達成 = 30
SOURCE:苦痛 = 1200
SOURCE:恐怖 = 2200
SOURCE:中毒 = 200
SOURCE:欲情 = 400
SOURCE:露出 = 100
SOURCE:屈従 = 800
SOURCE:逸脱 = 550
SOURCE:反感 = 900

CALL STRANGLE_SOURCE

;-------------------------------------------------
;絶頂チェック
;-------------------------------------------------
CALL SOURCE_CHECK_CVAB

;-------------------------------------------------
;射精チェック
;-------------------------------------------------
CALL SAMEN_CHECK, 1
CALL SAMEN_CHECK_T, 4

CALL SAMEN_SHOOT, 1, NOWEX:PLAYER:射精
CALL SAMEN_SHOOT_T, 4, NOWEX:射精

;-------------------------------------------------
;経験の処理
;-------------------------------------------------
CALL EXPUP_BASE, 2, 4

CALL EXPUP, "Ｖ経験", 1
CALL EXPUP, "性交経験", 1
CALL EXPUP, "性交経験", 1, PLAYER

IF !避妊具(PLAYER)
	CALL 魔力回復, 3
	CALL 獣人催淫, 1
ENDIF

経験回数:TARGET:(NOF(PLAYER)) += 1
経験回数:PLAYER:(NOF(TARGET)) += 1

RETURN 1

;-----------------------------------------------------------------------------------------
@USERCOM_ABLE_後背位首絞め
#FUNCTION

;首絞めのABLE
SIF !USERCOM_ABLE_首を絞める()
	COMRESULT = 0

;前コマンドが後背位なら派生可能
コマンド実行条件 += "前回と今回の実行者が同じで、後背位から派生可能/"
IF TFLAG:前コマンド実行者 == PLAYER
	SIF PREVPOSITIONS == "後背位"
		RETURNF COMRESULT
ENDIF

COMRESULT = 0
RETURNF 0

@COM_後背位首絞め
PRINTL 後背位首絞め
CALL KOJO_MESSAGE_COM

CALL STRANGLE_PLAYERS, 1200
CALL STRANGLE_TARGETS, 250

;-------------------------------------------------
;ソース追加処理
;-------------------------------------------------
;消費体力、気力
LOSEBASE:体力 += 120
LOSEBASE:気力 += 570

DOWNBASE:MASTER:体力 += 80
DOWNBASE:MASTER:気力 += 90

SOURCE:快V = 450
SOURCE:達成 = 40
SOURCE:苦痛 = 1250
SOURCE:恐怖 = 2300
SOURCE:中毒 = 200
SOURCE:欲情 = 350
SOURCE:露出 = 120
SOURCE:屈従 = 1000
SOURCE:逸脱 = 550
SOURCE:反感 = 1000

CALL STRANGLE_SOURCE

;-------------------------------------------------
;絶頂チェック
;-------------------------------------------------
CALL SOURCE_CHECK_CVAB

;-------------------------------------------------
;射精チェック
;-------------------------------------------------
CALL SAMEN_CHECK, 1
CALL SAMEN_CHECK_T, 4

CALL SAMEN_SHOOT, 1, NOWEX:PLAYER:射精
CALL SAMEN_SHOOT_T, 4, NOWEX:射精

;-------------------------------------------------
;経験の処理
;-------------------------------------------------
CALL EXPUP_BASE, 2, 4

CALL EXPUP, "Ｖ経験", 1
CALL EXPUP, "性交経験", 1
CALL EXPUP, "性交経験", 1, PLAYER

IF !避妊具(PLAYER)
	CALL 魔力回復, 3
	CALL 獣人催淫, 1
ENDIF

経験回数:TARGET:(NOF(PLAYER)) += 1
経験回数:PLAYER:(NOF(TARGET)) += 1

RETURN 1

;-----------------------------------------------------------------------------------------
@USERCOM_ABLE_正常位アナル首絞め
#FUNCTION

;首絞めのABLE
SIF !USERCOM_ABLE_首を絞める()
	COMRESULT = 0

;前コマンドが正常位アナルなら派生可能
コマンド実行条件 += "前回と今回の実行者が同じで、正常位アナルから派生可能/"
IF TFLAG:前コマンド実行者 == PLAYER
	SIF PREVPOSITIONS == "正常位アナル"
		RETURNF COMRESULT
ENDIF

COMRESULT = 0
RETURNF 0

@COM_正常位アナル首絞め
PRINTL 正常位アナル首絞め
CALL KOJO_MESSAGE_COM

CALL STRANGLE_PLAYERS, 1100
CALL STRANGLE_TARGETS, 450

;-------------------------------------------------
;ソース追加処理
;-------------------------------------------------
;消費体力、気力
LOSEBASE:体力 += 200
LOSEBASE:気力 += 500

DOWNBASE:MASTER:体力 += 80
DOWNBASE:MASTER:気力 += 90

SOURCE:快A = 400
SOURCE:達成 = 50
SOURCE:苦痛 = 1400
SOURCE:恐怖 = 1500
SOURCE:中毒 = 200
SOURCE:欲情 = 400
SOURCE:露出 = 150
SOURCE:屈従 = 1500
SOURCE:逸脱 = 500
SOURCE:反感 = 1000

CALL STRANGLE_SOURCE

;-------------------------------------------------
;絶頂チェック
;-------------------------------------------------
CALL SOURCE_CHECK_CVAB

;-------------------------------------------------
;射精チェック
;-------------------------------------------------
CALL SAMEN_CHECK, 2
CALL SAMEN_CHECK_T, 5

CALL SAMEN_SHOOT, 2, NOWEX:PLAYER:射精
CALL SAMEN_SHOOT_T, 5, NOWEX:射精

;-------------------------------------------------
;経験の処理
;-------------------------------------------------
CALL EXPUP_BASE, 2, 4

CALL EXPUP, "Ａ経験", 1
CALL EXPUP, "性交経験", 1
CALL EXPUP, "性交経験", 1, PLAYER

IF !避妊具(PLAYER)
	CALL 魔力回復, 3
	CALL 獣人催淫, 1
ENDIF

経験回数:TARGET:(NOF(PLAYER)) += 1
経験回数:PLAYER:(NOF(TARGET)) += 1

RETURN 1

;-----------------------------------------------------------------------------------------
@USERCOM_ABLE_後背位アナル首絞め
#FUNCTION

;首絞めのABLE
SIF !USERCOM_ABLE_首を絞める()
	COMRESULT = 0

;前コマンドが後背位アナルなら派生可能
コマンド実行条件 += "前回と今回の実行者が同じで、後背位アナルから派生可能/"
IF TFLAG:前コマンド実行者 == PLAYER
	SIF PREVPOSITIONS == "後背位アナル"
		RETURNF COMRESULT
ENDIF

COMRESULT = 0
RETURNF 0

@COM_後背位アナル首絞め
PRINTL 後背位アナル首絞め
CALL KOJO_MESSAGE_COM

CALL STRANGLE_PLAYERS, 1350
CALL STRANGLE_TARGETS, 500

;-------------------------------------------------
;ソース追加処理
;-------------------------------------------------
;消費体力、気力
LOSEBASE:体力 += 200
LOSEBASE:気力 += 500

DOWNBASE:MASTER:体力 += 80
DOWNBASE:MASTER:気力 += 90

SOURCE:快A = 450
SOURCE:達成 = 60
SOURCE:苦痛 = 1500
SOURCE:恐怖 = 1500
SOURCE:中毒 = 200
SOURCE:欲情 = 500
SOURCE:露出 = 200
SOURCE:屈従 = 1500
SOURCE:逸脱 = 500
SOURCE:反感 = 1100

CALL STRANGLE_SOURCE

;-------------------------------------------------
;絶頂チェック
;-------------------------------------------------
CALL SOURCE_CHECK_CVAB

;-------------------------------------------------
;射精チェック
;-------------------------------------------------
CALL SAMEN_CHECK, 2
CALL SAMEN_CHECK_T, 5

CALL SAMEN_SHOOT, 2, NOWEX:PLAYER:射精
CALL SAMEN_SHOOT_T, 5, NOWEX:射精

;-------------------------------------------------
;経験の処理
;-------------------------------------------------
CALL EXPUP_BASE, 2, 4

CALL EXPUP, "Ａ経験", 1
CALL EXPUP, "性交経験", 1
CALL EXPUP, "性交経験", 1, PLAYER

IF !避妊具(PLAYER)
	CALL 魔力回復, 3
	CALL 獣人催淫, 1
ENDIF

経験回数:TARGET:(NOF(PLAYER)) += 1
経験回数:PLAYER:(NOF(TARGET)) += 1

RETURN 1

;-----------------------------------------------------------------------------------------
@USERCOM_ABLE_逆レイプ首絞め
#FUNCTION

;首絞めのABLE
SIF !USERCOM_ABLE_首を絞める()
	COMRESULT = 0

;前コマンドが逆レイプなら派生可能
コマンド実行条件 += "前回と今回の実行者が同じで、逆レイプから派生可能/"
IF TFLAG:前コマンド実行者 == PLAYER
	SIF PREVPOSITIONS == "逆レイプ"
		RETURNF COMRESULT
ENDIF

COMRESULT = 0
RETURNF 0

@COM_逆レイプ首絞め
#DIM DYNAMIC 射精先

PRINTL 逆レイプ首絞め
CALL KOJO_MESSAGE_COM

CALL STRANGLE_PLAYERS, 700
CALL STRANGLE_TARGETS, 1000

;-------------------------------------------------
;ソース追加処理
;-------------------------------------------------
;消費体力、気力
LOSEBASE:体力 += 150
LOSEBASE:気力 += 350

DOWNBASE:MASTER:体力 += 90
DOWNBASE:MASTER:気力 += 90

SOURCE:快C = 500
SOURCE:達成 = 150
SOURCE:苦痛 = 200
SOURCE:恐怖 = 1800
SOURCE:中毒 = 200
SOURCE:欲情 = 900
SOURCE:露出 = 300
SOURCE:屈従 = 2000
SOURCE:逸脱 = 500
SOURCE:反感 = 900

CALL STRANGLE_SOURCE

;-------------------------------------------------
;絶頂チェック
;-------------------------------------------------
CALL SOURCE_CHECK_CVAB

;-------------------------------------------------
;射精チェック
;-------------------------------------------------
;射精時の処理
IF RESULT
	SELECTCASE SEX(PLAYER)
		CASE 1
			IF PLAYER == TMASTER
				射精先 = 6
			ELSEIF PLAYER == ASSI
				射精先 = 7
			ENDIF
		CASE 2
			IF PLAYER == TMASTER
				射精先 = 1
			ELSEIF PLAYER == ASSI
				射精先 = 2
			ENDIF
	ENDSELECT
ENDIF

CALL SAMEN_CHECK, 6
CALL SAMEN_CHECK_T, 射精先

CALL SAMEN_SHOOT, 6, NOWEX:PLAYER:射精
CALL SAMEN_SHOOT_T, 射精先, NOWEX:射精

;-------------------------------------------------
;経験の処理
;-------------------------------------------------
CALL EXPUP_BASE, 3, 5

SELECTCASE TFLAG:奴隷挿入箇所
	CASE 1
		CALL EXPUP, "Ｖ経験", 1, PLAYER
	CASE 2
		CALL EXPUP, "Ａ経験", 1, PLAYER
ENDSELECT

CALL EXPUP, "性交経験", 1
CALL EXPUP, "性交経験", 1, PLAYER

IF !避妊具(TARGET)
	CALL 魔力回復, 3, PLAYER
	CALL 獣人催淫, 1, PLAYER
ENDIF

経験回数:PLAYER:(NOF(TARGET)) += 1
経験回数:TARGET:(NOF(PLAYER)) += 1

RETURN 1

;-----------------------------------------------------------------------------------------
@USERCOM_ABLE_首絞め愛撫
#FUNCTION

;首絞めから派生可能
コマンド実行条件 += "前回と今回の実行者が同じで、首を絞めるから派生可能/"
IF TFLAG:前コマンド実行者 == PLAYER
	SIF PREVCOMS == "首を絞める"
		RETURNF COMRESULT
ENDIF

COMRESULT = 0
RETURNF 0

@COM_首絞め愛撫
PRINTL 首絞め愛撫
CALL KOJO_MESSAGE_COM

;-------------------------------------------------
;ソース追加処理
;-------------------------------------------------
;消費体力、気力
LOSEBASE:体力 += 60
LOSEBASE:気力 += 400

DOWNBASE:MASTER:体力 += 70
DOWNBASE:MASTER:気力 += 50

SIF 陥落(TARGET)
	SOURCE:情愛 += 300
SIF TALENT:倒錯的
	SOURCE:情愛 += 100
SIF TALENT:マゾ
	SOURCE:情愛 += 100
SIF TALENT:妄信
	SOURCE:情愛 += 100

SOURCE:情愛 += CFLAG:依存度/10

SOURCE:快C = 30
SOURCE:快B = 30
SOURCE:達成 = 30
SOURCE:苦痛 = 1200
SOURCE:恐怖 = 2200
SOURCE:欲情 = 400
SOURCE:屈従 = 800
SOURCE:逸脱 = 550
SOURCE:反感 = 1000

;-------------------------------------------------
;特殊ソース処理
;-------------------------------------------------
;苦痛のパラメータによる苦痛のソース増加は先に処理しておく
SOURCE:苦痛 += GETPALAMLV(PALAM:苦痛, 4)*(SOURCE:苦痛/2)

;-------------------------------------------------
;絶頂チェック
;-------------------------------------------------
CALL SOURCE_CHECK_CVAB

;-------------------------------------------------
;射精チェック
;-------------------------------------------------
CALL SAMEN_CHECK_T, 0

CALL SAMEN_SHOOT_T, 0, NOWEX:射精

;-------------------------------------------------
;経験の処理
;-------------------------------------------------
CALL EXPUP_BASE, 1, 4

RETURN 1

;-------------------------------------------------
;射精ゲージチェック（主人）
;-------------------------------------------------
@STRANGLE_PLAYERS, 増加量
#DIM DYNAMIC 増加量

;ABL:調教者の技巧をみる
増加量 += (増加量/5)*ABL:PLAYER:技巧

;PALAM:潤滑をみる
増加量 += (GETPALAMLV(PALAM:潤滑, 4)-2)*(増加量/5)

SELECTCASE SELECTCOMS
	CASE "正常位首絞め", "後背位首絞め", "正常位アナル首絞め", "後背位アナル首絞め"
		;プレイヤーのABL:Ｃ感覚をみる
		SELECTCASE ABL:PLAYER:Ｃ感覚
			CASE 0
				TIMES 増加量 , 1.00
			CASE 1
				TIMES 増加量 , 1.50
			CASE 2
				TIMES 増加量 , 2.00
			CASE 3
				TIMES 増加量 , 2.50
			CASE 4
				TIMES 増加量 , 3.50
			CASEELSE
				増加量 += 増加量*(ABL:PLAYER:Ｃ感覚-1)
		ENDSELECT
	CASE "逆アナル首絞め"
		SELECTCASE TFLAG:奴隷挿入箇所
			CASE 1
				;プレイヤーのABL:Ｖ感覚をみる
				SELECTCASE ABL:PLAYER:Ｖ感覚
					CASE 0
						TIMES 増加量 , 0.50
					CASE 1
						TIMES 増加量 , 0.80
					CASE 2
						TIMES 増加量 , 1.00
					CASE 3
						TIMES 増加量 , 1.50
					CASE 4
						TIMES 増加量 , 2.00
					CASEELSE
						増加量 += (増加量/2)*ABL:PLAYER:Ｖ感覚
				ENDSELECT
			CASE 2
				;プレイヤーのABL:Ａ感覚をみる
				SELECTCASE ABL:PLAYER:Ａ感覚
					CASE 0
						TIMES 増加量 , 0.50
					CASE 1
						TIMES 増加量 , 0.80
					CASE 2
						TIMES 増加量 , 1.00
					CASE 3
						TIMES 増加量 , 1.50
					CASE 4
						TIMES 増加量 , 2.00
					CASEELSE
						増加量 += (増加量/2)*ABL:PLAYER:Ａ感覚
				ENDSELECT
		ENDSELECT
ENDSELECT

;倒錯的、サド、狂気だと増える
SIF TALENT:PLAYER:倒錯的 || TALENT:PLAYER:サド || TALENT:PLAYER:狂気
	TIMES 増加量 , 1.50

CALL 射精ゲージ増加, 増加量, PLAYER

;-------------------------------------------------
;射精ゲージチェック（奴隷）
;-------------------------------------------------
@STRANGLE_TARGETS, 増加量
#DIM DYNAMIC 増加量

;ABL:調教者の技巧をみる
増加量 += (増加量/5)*ABL:PLAYER:技巧

;ABL:欲望をみる
増加量 += (増加量/10)*ABL:欲望

;PALAM:潤滑をみる
増加量 += (GETPALAMLV(PALAM:潤滑, 4)-3)*(増加量/5)

;奴隷のABL:Ｖ感覚をみる
SELECTCASE SELECTCOMS
	CASE "正常位首絞め", "後背位首絞め"
		SELECTCASE ABL:Ｖ感覚
			CASE 0
				TIMES 増加量 , 0.50
			CASE 1
				TIMES 増加量 , 0.80
			CASE 2
				TIMES 増加量 , 1.00
			CASE 3
				TIMES 増加量 , 1.50
			CASE 4
				TIMES 増加量 , 2.00
			CASEELSE
				増加量 += (増加量/2)*ABL:Ｖ感覚
		ENDSELECT
	CASE "正常位アナル首絞め", "後背位アナル首絞め"
		SELECTCASE ABL:Ａ感覚
			CASE 0
				TIMES 増加量 , 0.50
			CASE 1
				TIMES 増加量 , 0.80
			CASE 2
				TIMES 増加量 , 1.00
			CASE 3
				TIMES 増加量 , 1.50
			CASE 4
				TIMES 増加量 , 2.00
			CASEELSE
				増加量 += (増加量/2)*ABL:Ａ感覚
		ENDSELECT
	CASE "逆アナル首絞め"
		SELECTCASE ABL:Ｃ感覚
			CASE 0
				TIMES 増加量 , 0.50
			CASE 1
				TIMES 増加量 , 0.80
			CASE 2
				TIMES 増加量 , 1.00
			CASE 3
				TIMES 増加量 , 1.50
			CASE 4
				TIMES 増加量 , 2.00
			CASEELSE
				増加量 += (増加量/2)*ABL:Ｃ感覚
		ENDSELECT
ENDSELECT

;奴隷のABL:マゾっ気をみる
増加量 += (増加量/3)*ABL:マゾっ気

CALL 射精ゲージ増加, 増加量, TARGET

;-------------------------------------------------
;特殊ソース処理
;-------------------------------------------------
@STRANGLE_SOURCE
#DIM DYNAMIC PAIN
;素質などで情愛ソースが変化
SIF 陥落(TARGET)
	SOURCE:情愛 += 300
SIF TALENT:倒錯的
	SOURCE:情愛 += 100
SIF TALENT:マゾ
	SOURCE:情愛 += 100
SIF TALENT:妄信
	SOURCE:情愛 += 100

SOURCE:情愛 += CFLAG:依存度/10

;苦痛のパラメータによる苦痛のソース増加は先に処理しておく
SOURCE:苦痛 += GETPALAMLV(PALAM:苦痛, 4)*(SOURCE:苦痛/2)

;抑圧、抵抗持ちには、抑鬱ソース追加
SIF TALENT:抑圧 || TALENT:抵抗
	SOURCE:鬱屈 += 300

;貞操観念持ちで恋慕、親愛持ち以外には常に反発のソースを追加する（セックス系のみ）
SELECTCASE SELECTCOMS
	CASE "正常位首絞め", "後背位首絞め"
		SIF TALENT:貞操観念 && FALLTYPE(TARGET) != 1 && PLAYER != MASTER
			SOURCE:反感 += 1000
ENDSELECT

;V、Aへの苦痛は先に処理しておく
;EXP:Ｖ経験、Ａ経験をみる（処女の反感は別途処理済みなので省略）
;首絞め系は苦痛は半分以下にならない
PAIN = SOURCE:苦痛/2
SELECTCASE SELECTCOMS
	CASE "正常位首絞め", "後背位首絞め"
		CALL 特殊ソース処理_Ｖ
	CASE "正常位アナル首絞め", "後背位アナル首絞め"
		CALL 特殊ソース処理_Ａ
ENDSELECT

SIF SOURCE:苦痛 < PAIN
	SOURCE:苦痛 = PAIN

CALL 特殊ソース処理_セックス
