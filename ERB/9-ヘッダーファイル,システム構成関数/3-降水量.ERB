@PRECIPITATION
#DIM DYNAMIC F1
	;1ミリ以上になる日数
#DIM DYNAMIC F10
	;10ミリ以上になる日数
#DIM DYNAMIC P_A
	;関数F(X)のパラメータA
#DIM DYNAMIC P_B
	;関数F(X)のパラメータB
#DIM DYNAMIC R_MM, 51
	;R_MM:Xで雨量Xミリ以上になる確率(パーセント)
#DIM DYNAMIC LCOUNT
#DIM DYNAMIC 降水確率

;降水量を算出する関数

;次のような流れで導き出す
;降水量Xミリ以上になる確率(パーセント)を算出する関数F(X)をパラメータA,Bを用いて、
;F(X) = AX + B  (X>0) とおく
;ただし、例外としてF(0)=100とする(降水量0ミリ以上になる確率は100パーセント)
;一般に F(1)>F(10) なのでAは負の値をとるため、Xを大きくするとF(X)はマイナスになってしまうが、
;IF分岐の挙動から問題ない
;この関数をおいたあと、気象庁から東京の1981年～2010年の1日ごとの
;1ミリ以上になる日数(X=1のときのF(1)の値)と10ミリ以上になる日数(X=10のときのF(10)の値)を取得する
;例えば1月1日は1ミリ以上になる日数が0.12日なので、12パーセントの確率で1ミリ以上になると考える
;平面座標(X,F(X))における2点を定めると関数F(X)は一意に定まる(パラメータA,Bの値が確定する)
;次の連立方程式でA,Bの値を求める
;	F(1)  =   A + B …①
;	F(10) = 10A + B …②
;(②－①)÷9よりAの値を求める
;Aの値を出したら、①より
;	B = F(1) - A

;雨量のサンプルを取得して代入
CALL TOKYO_STYLE_RAINY_DAY
F1 = RESULT
F10 = RESULT:1

;はじめにAの値を1000倍で求める
P_A = 1000 * (F10 - F1) /9

;Aの値を用いてBの値を1000倍で求める
P_B = 1000*F1 - P_A

;パラメータA,B(変数P_A,P_B)が求まったので具体的に計算
;F(X) = (P_A*X + P_B) / 1000
;パラメータA,Bが1000倍になっているので、最後に1000で割る
FOR LCOUNT, 1, 51
	R_MM:LCOUNT = (P_A * LCOUNT + P_B)/1000
NEXT

;R_MM:1～R_MM:50の値が揃ったのであとはその分布に従い雨量を出す

;51から100%
降水確率 = RAND(1, 101)

FOR LCOUNT, 1, 52
	IF LCOUNT == 51
		FLAG:降水量 = 50
	ELSEIF 降水確率 > R_MM:LCOUNT
		IF LCOUNT == 1 && (スウィートレイン || スノープリズム)
			FLAG:降水量 = 1
			BREAK
		ENDIF
		FLAG:降水量 = LCOUNT-1
		BREAK
	ENDIF
NEXT


;気象庁から東京の1981年～2010年の1日ごとの、1ミリ以上になる日数と10ミリ以上になる日数を取得する関数
;1日に対するパーセンテージで取得するため0.12日は12として扱う
@TOKYO_STYLE_RAINY_DAY
#DIM DYNAMIC 降水確率
#DIM DYNAMIC 大雨確率
#DIM DYNAMIC RAINYBUFF, 31

#DIM DYNAMIC 降水_1 = 12, 12, 13, 13, 14, 14, 14, 15, 15, 15, 15, 15, 15, 15, 15, 16, 16, 16, 16, 17, 17, 16, 16, 16, 16, 15, 15, 15, 14, 14, 14
#DIM DYNAMIC 降水_2 = 14, 14, 15, 15, 15, 16, 16, 16, 17, 17, 18, 18, 19, 19, 20, 20, 21, 21, 22, 23, 23, 24, 24, 25, 25, 26, 26, 26, 26
#DIM DYNAMIC 降水_3 = 26, 27, 27, 27, 27, 27, 27, 27, 27, 28, 28, 29, 29, 30, 31, 32, 32, 33, 34, 34, 35, 35, 35, 35, 35, 35, 35, 34, 34, 34, 33
#DIM DYNAMIC 降水_4 = 33, 33, 33, 33, 33, 33, 34, 34, 34, 35, 35, 35, 35, 35, 35, 35, 35, 35, 34, 34, 34, 33, 33, 33, 32, 32, 31, 31, 30, 30
#DIM DYNAMIC 降水_5 = 30, 30, 30, 30, 30, 30, 31, 31, 32, 33, 34, 34, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 34, 34, 34, 33, 33, 32, 31, 30, 30
#DIM DYNAMIC 降水_6 = 29, 29, 29, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 39, 40, 41, 41, 42, 43, 43, 44, 44, 45, 45, 45, 45, 45, 44, 44
#DIM DYNAMIC 降水_7 = 43, 42, 41, 40, 39, 38, 37, 37, 36, 36, 35, 35, 35, 35, 34, 34, 33, 33, 32, 32, 31, 30, 30, 29, 28, 28, 27, 26, 26, 25, 25
#DIM DYNAMIC 降水_8 = 25, 24, 24, 24, 24, 24, 24, 25, 25, 25, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 25, 25, 25, 26, 26, 26, 26, 27, 27, 27, 27
#DIM DYNAMIC 降水_9 = 28, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 39, 39, 40, 40, 40, 40, 41, 41, 40, 40, 40, 40, 40, 40, 39, 39, 39
#DIM DYNAMIC 降水_10 = 38, 38, 38, 38, 38, 37, 37, 37, 36, 36, 35, 34, 33, 32, 32, 31, 31, 30, 30, 29, 29, 29, 29, 28, 28, 27, 26, 26, 25, 25, 24
#DIM DYNAMIC 降水_11 = 24, 24, 24, 24, 24, 24, 25, 25, 25, 25, 25, 24, 24, 24, 23, 23, 23, 22, 22, 21, 21, 21, 21, 20, 20, 20, 20, 19, 19, 19
#DIM DYNAMIC 降水_12 = 19, 18, 18, 18, 17, 17, 17, 16, 16, 16, 15, 15, 15, 14, 14, 13, 13, 13, 12, 12, 12, 11, 11, 11, 11, 11, 11, 11, 11, 11, 12

#DIM DYNAMIC 大雨_1 = 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 6, 6, 6, 6, 6, 5
#DIM DYNAMIC 大雨_2 = 5, 5, 5, 4, 4, 4, 4, 4, 5, 5, 5, 6, 7, 7, 8, 8, 9, 9, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10
#DIM DYNAMIC 大雨_3 = 10, 10, 10, 10, 10, 10, 10, 11, 11, 11, 12, 12, 12, 13, 13, 13, 14, 14, 14, 14, 14, 15, 15, 15, 15, 16, 16, 16, 16, 16, 16
#DIM DYNAMIC 大雨_4 = 16, 16, 16, 16, 16, 15, 15, 15, 15, 15, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 13, 13, 12, 12, 12, 11, 11, 11
#DIM DYNAMIC 大雨_5 = 11, 11, 11, 12, 12, 13, 3, 14, 14, 15, 15, 16, 16, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 16, 16, 16, 16, 16, 15, 15, 15, 
#DIM DYNAMIC 大雨_6 = 14, 14, 14, 14, 15, 15, 16, 16, 17, 18, 18, 19, 19, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 19
#DIM DYNAMIC 大雨_7 = 19, 19, 18, 18, 17, 17, 16, 16, 15, 14, 14, 13, 13, 13, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 11
#DIM DYNAMIC 大雨_8 = 11, 11, 11, 11, 11, 11, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 11, 11, 11, 11, 11, 11, 12, 12, 12, 12, 13, 13, 14
#DIM DYNAMIC 大雨_9 = 14, 14, 15, 15, 16, 17, 17, 18, 18, 18, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 20, 20, 20, 20, 20, 20, 20
#DIM DYNAMIC 大雨_10 = 20, 20, 20, 20, 21, 21, 20, 20, 20, 20, 19, 19, 18, 17, 17, 16, 16, 15, 15, 15, 14, 14, 14, 13, 13, 12, 12, 12, 11, 11, 11
#DIM DYNAMIC 大雨_11 = 10, 10, 10, 10, 10, 10, 10, 9, 9, 9, 9, 9, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8
#DIM DYNAMIC 大雨_12 = 8, 8, 7, 7, 7, 7, 7, 6, 6, 6, 6, 5, 5, 5, 5, 5, 5, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5

ARRAYCOPY @"降水_{MONTH}", "RAINYBUFF"
降水確率 = RAINYBUFF:(DAYS-1)
ARRAYCOPY @"大雨_{MONTH}", "RAINYBUFF"
大雨確率 = RAINYBUFF:(DAYS-1)

RETURN 降水確率, 大雨確率
