;奴隷売却の処理
@CHARA_SELL
#DIM DYNAMIC LOCALTARGET
#DIM DYNAMIC LOCALASSI
#DIM DYNAMIC PRICE
#DIM DYNAMIC LCOUNT

VARSET LOCAL, 0

DRAWLINE
PRINTL □誰を売りますか？
FOR LCOUNT, 0, CHARANUM
	SIF LCOUNT == MASTER
		CONTINUE
	;育児部屋に移動しているキャラは除外
	SIF CHECK_CHILD_CARE(LCOUNT)
		CONTINUE
	;売却不可フラグが立ってるキャラは除外
	SIF CFLAG:LCOUNT:売却不可
		CONTINUE
	IF CFLAG:LCOUNT:状態 >= 1 || CFLAG:LCOUNT:配属 >= 1
		PRINTFORM 　[{LCOUNT}] %NAME:LCOUNT% 
		IF ASSI == LCOUNT
			PRINT (助手)
		ELSEIF ISASSI:LCOUNT
			PRINT (元助手)
		ELSEIF CFLAG:LCOUNT:状態 == 2
			PRINT (助手可)
		ENDIF
		PRINTL 
	ENDIF
NEXT
DRAWLINE
PRINTPLAIN 　SELL SLAVE　
PRINTL [10000] 戻る

INPUT

SELECTCASE RESULT
	CASE 10000
		RETURN 0
	CASE 0 TO CHARANUM
		SIF CFLAG:RESULT:状態 == 0 || RESULT == MASTER
			RESTART
		;育児部屋のキャラは売却不可
		SIF CHECK_CHILD_CARE(RESULT)
			RESTART
		;売却処理
		LOCALTARGET = TARGET
		LOCALASSI = ASSI
		TARGET = RESULT
ENDSELECT

SIF TARGET == MASTER
	RESTART

PRICE = 0

;ABLによる基礎値計算
LOCAL = 0
REPEAT VARSIZE("ABL")
	SELECTCASE ABLNAME:COUNT
		;従順、欲望、技巧、奉仕精神、露出癖のテーブル
		CASE "従順", "欲望", "技巧", "奉仕精神", "露出癖"
			SELECTCASE ABL:COUNT
				CASE 0
					LOCAL = 0
				CASE 1
					LOCAL = 1000
				CASE 2
					LOCAL = 1500
				CASE 3
					LOCAL = 2500
				CASE 4
					LOCAL = 4000
				CASE 5
					LOCAL = 6000
				CASE 6
					LOCAL = 8500
				CASE 7
					LOCAL = 11500
				CASE 8
					LOCAL = 15000
				CASE 9
					LOCAL = 19000
				CASEELSE
					LOCAL = 25000
			ENDSELECT
			SIF LOCAL > 0
				PRINTFORML %ABLNAME:COUNT%LV{ABL:COUNT}+{LOCAL}
			PRICE += LOCAL
		;感度のテーブル
		CASE "Ｃ感覚", "Ｖ感覚", "Ａ感覚", "Ｂ感覚"
			SELECTCASE ABL:COUNT
				CASE 0
					LOCAL = 0
				CASE 1
					LOCAL = 1000
				CASE 2
					LOCAL = 1600
				CASE 3
					LOCAL = 2800
				CASE 4
					LOCAL = 4600
				CASE 5
					LOCAL = 7000
				CASE 6
					LOCAL = 10000
				CASE 7
					LOCAL = 13600
				CASE 8
					LOCAL = 17800
				CASE 9
					LOCAL = 22600
				CASEELSE
					LOCAL = 30000
			ENDSELECT
			SIF LOCAL > 0
				PRINTFORML %ABLNAME:COUNT%LV{ABL:COUNT}+{LOCAL}
			PRICE += LOCAL
		;サドっ気、レズっ気、サドっ気、ホモっ気のテーブル
		CASE "マゾっ気", "サドっ気", "レズっ気", "ホモっ気"
			SELECTCASE ABL:COUNT
				CASE 0
					LOCAL = 0
				CASE 1
					LOCAL = 1000
				CASE 2
					LOCAL = 1400
				CASE 3
					LOCAL = 2200
				CASE 4
					LOCAL = 3400
				CASE 5
					LOCAL = 5000
				CASE 6
					LOCAL = 7000
				CASE 7
					LOCAL = 9400
				CASE 8
					LOCAL = 12200
				CASE 9
					LOCAL = 15400
				CASEELSE
					LOCAL = 20000
			ENDSELECT
			SIF LOCAL > 0
				PRINTFORML %ABLNAME:COUNT%LV{ABL:COUNT}+{LOCAL}
			PRICE += LOCAL
		;料理技能、撮影技能、歌唱技能、家事技能、演奏技能のテーブル
		CASE "料理技能", "撮影技能", "歌唱技能", "家事技能", "演奏技能"
			SELECTCASE ABL:COUNT
				CASE 0
					LOCAL = 0
				CASE 1
					LOCAL = 800
				CASE 2
					LOCAL = 1100
				CASE 3
					LOCAL = 1700
				CASE 4
					LOCAL = 2600
				CASE 5
					LOCAL = 3800
				CASE 6
					LOCAL = 5300
				CASE 7
					LOCAL = 7100
				CASE 8
					LOCAL = 9200
				CASE 9
					LOCAL = 11600
				CASEELSE
					LOCAL = 15000
			ENDSELECT
			SIF LOCAL > 0
				PRINTFORML %ABLNAME:COUNT%LV{ABL:COUNT}+{LOCAL}
			PRICE += LOCAL
		;中毒のテーブル
		CASE "自慰中毒", "精液中毒", "レズ中毒", "ゲイ中毒", "性交中毒", "噴乳中毒"
			SELECTCASE ABL:COUNT
				CASE 0
					LOCAL = 0
				CASE 1
					LOCAL = 2000
				CASE 2
					LOCAL = 3000
				CASE 3
					LOCAL = 5000
				CASE 4
					LOCAL = 8000
				CASE 5
					LOCAL = 12000
				CASE 6
					LOCAL = 17000
				CASE 7
					LOCAL = 23000
				CASE 8
					LOCAL = 30000
				CASE 9
					LOCAL = 38000
				CASEELSE
					LOCAL = 50000
			ENDSELECT
			SIF LOCAL > 0
				PRINTFORML %ABLNAME:COUNT%LV{ABL:COUNT}+{LOCAL}
			PRICE += LOCAL
	ENDSELECT
REND

SETCOLOR 100, 150, 250
PRINTFORML 能力価格 = {PRICE}
RESETCOLOR

PRINTL 
LOCAL = 100
;素質による売却額補正値計算
IF TALENT:処女
	LOCAL += 100
	PRINTL 処女 +100%
ENDIF
IF TALENT:再生処女
	LOCAL += 50
	PRINTL 再生処女 +50%
ENDIF

;素質による増減
;陥落素質
IF TALENT:恋慕
	PRINTL 恋慕 -30%
	LOCAL -= 30
ENDIF
IF TALENT:淫乱
	PRINTL 淫乱 +30%
	LOCAL += 30
ENDIF
IF TALENT:服従
	PRINTL 服従 +100%
	LOCAL += 100
ENDIF
IF TALENT:親愛
	PRINTL 親愛 -50%
	LOCAL -= 50
ENDIF
IF TALENT:娼婦
	PRINTL 娼婦 +60%
	LOCAL += 60
ENDIF
IF TALENT:隷属
	PRINTL 隷属 +200%
	LOCAL += 200
ENDIF

;その他素質
IF TALENT:臆病
	PRINTL 臆病 -10%
	LOCAL -= 10
ENDIF
IF TALENT:反抗的
	PRINTL 反抗的 +50%
	LOCAL += 50
ENDIF
IF TALENT:気丈
	PRINTL 気丈 +50%
	LOCAL += 50
ENDIF
IF TALENT:素直
	PRINTL 素直 -20%
	LOCAL -= 20
ENDIF
IF TALENT:大人しい
	PRINTL 大人しい -10%
	LOCAL -= 10
ENDIF
IF TALENT:プライド高い
	PRINTL プライド高い +50%
	LOCAL += 50
ENDIF
IF TALENT:生意気
	PRINTL 生意気 +50%
	LOCAL += 50
ENDIF
IF TALENT:プライド低い
	PRINTL プライド低い -10%
	LOCAL -= 10
ENDIF
IF TALENT:ツンデレ
	PRINTL ツンデレ +30%
	LOCAL += 30
ENDIF
IF TALENT:自制心
	PRINTL 自制心 +50%
	LOCAL += 50
ENDIF
IF TALENT:無関心
	PRINTL 無関心 +50%
	LOCAL += 50
ENDIF
IF TALENT:感情乏しい
	PRINTL 感情乏しい +60%
	LOCAL += 60
ENDIF
IF TALENT:好奇心
	PRINTL 好奇心 -20%
	LOCAL -= 20
ENDIF
IF TALENT:保守的
	PRINTL 保守的 +40%
	LOCAL += 40
ENDIF
IF TALENT:一線越えない
	PRINTL 一線越えない +60%
	LOCAL += 60
ENDIF
IF TALENT:目立ちたがり
	PRINTL 目立ちたがり -10%
	LOCAL -= 10
ENDIF
IF TALENT:貞操観念
	PRINTL 貞操観念 +30%
	LOCAL += 30
ENDIF
IF TALENT:貞操無頓着
	PRINTL 貞操無頓着 -10%
	LOCAL -= 10
ENDIF
IF TALENT:解放
	PRINTL 解放 -20%
	LOCAL -= 20
ENDIF
IF TALENT:恥じらい
	PRINTL 恥じらい +20%
	LOCAL += 20
ENDIF
IF TALENT:恥薄い
	PRINTL 恥薄い -10%
	LOCAL -= 10
ENDIF
IF TALENT:痛みに弱い
	PRINTL 痛みに弱い +50%
	LOCAL += 50
ENDIF
IF TALENT:痛みに強い
	PRINTL 痛みに強い -20%
	LOCAL -= 20
ENDIF
IF TALENT:濡れやすい
	PRINTL 濡れやすい -10%
	LOCAL -= 10
ENDIF
IF TALENT:濡れにくい
	PRINTL 濡れにくい +20%
	LOCAL += 20
ENDIF
IF TALENT:習得早い
	PRINTL 習得早い -20%
	LOCAL -= 20
ENDIF
IF TALENT:習得遅い
	PRINTL 習得遅い +30%
	LOCAL += 30
ENDIF
IF TALENT:舌使い
	PRINTL 舌使い +10%
	LOCAL += 10
ENDIF
IF TALENT:針さばき
	PRINTL 針さばき +10%
	LOCAL += 10
ENDIF
IF TALENT:猫舌
	PRINTL 猫舌 +10%
	LOCAL += 10
ENDIF
IF TALENT:調合知識
	PRINTL 調合知識 +20%
	LOCAL += 20
ENDIF
IF TALENT:薬毒耐性
	PRINTL 薬毒耐性 +30%
	LOCAL += 30
ENDIF
IF TALENT:おもらし癖
	PRINTL おもらし癖 +10%
	LOCAL += 10
ENDIF
IF TALENT:自慰しやすい
	PRINTL 自慰しやすい -10%
	LOCAL -= 10
ENDIF
IF TALENT:汚臭鈍感
	PRINTL 汚臭鈍感 -10%
	LOCAL -= 10
ENDIF
IF TALENT:汚臭敏感
	PRINTL 汚臭敏感 +20%
	LOCAL += 20
ENDIF
IF TALENT:献身的
	PRINTL 献身的 -20%
	LOCAL -= 20
ENDIF
IF TALENT:汚れ無視
	PRINTL 汚れ無視 -10%
	LOCAL -= 10
ENDIF
IF TALENT:快感に素直
	PRINTL 快感に素直 -20%
	LOCAL -= 20
ENDIF
IF TALENT:快感の否定
	PRINTL 快感の否定 +40%
	LOCAL += 40
ENDIF
IF TALENT:自慰狂い
	PRINTL 自慰狂い +50%
	LOCAL += 50
ENDIF
IF TALENT:セックス狂
	PRINTL セックス狂 +50%
	LOCAL += 50
ENDIF
IF TALENT:尻穴狂い
	PRINTL 尻穴狂い +50%
	LOCAL += 50
ENDIF
IF TALENT:淫乳
	PRINTL 淫乳 +50%
	LOCAL += 50
ENDIF
IF TALENT:倒錯的
	PRINTL 倒錯的 -20%
	LOCAL -= 20
ENDIF
IF TALENT:男嫌い
	PRINTL 男嫌い +20%
	LOCAL += 20
ENDIF
IF TALENT:サド
	PRINTL サド +30%
	LOCAL += 30
ENDIF
IF TALENT:マゾ
	PRINTL マゾ +30%
	LOCAL += 30
ENDIF
IF TALENT:妄信
	PRINTL 妄信 +40%
	LOCAL += 40
ENDIF
IF TALENT:小悪魔
	PRINTL 小悪魔 +10%
	LOCAL += 10
ENDIF
IF TALENT:女嫌い
	PRINTL 女嫌い +20%
	LOCAL += 20
ENDIF
IF TALENT:妖狐
	PRINTL 妖狐 +10%
	LOCAL += 10
ENDIF
IF TALENT:魅力
	PRINTL 魅力 +30%
	LOCAL += 30
ENDIF
IF TALENT:謎の魅力
	PRINTL 謎の魅力 +50%
	LOCAL += 50
ENDIF
IF TALENT:小柄体型
	PRINTL 小柄体型 +20%
	LOCAL += 20
ENDIF
IF TALENT:Ｃ鈍感 && ABL:Ｃ感覚 >= 3
	PRINTL Ｃ鈍感 +30%
	LOCAL += 30
ENDIF
IF TALENT:Ｃ敏感
	PRINTL Ｃ敏感 -10%
	LOCAL -= 10
ENDIF
IF TALENT:Ｖ鈍感 && ABL:Ｖ感覚 >= 3
	PRINTL Ｖ鈍感 +30%
	LOCAL += 30
ENDIF
IF TALENT:Ｖ敏感
	PRINTL Ｖ敏感 -10%
	LOCAL -= 10
ENDIF
IF TALENT:Ａ鈍感 && ABL:Ａ感覚 >= 3
	PRINTL Ａ鈍感 +30%
	LOCAL += 30
ENDIF
IF TALENT:Ａ敏感
	PRINTL Ａ敏感 -10%
	LOCAL -= 10
ENDIF
IF TALENT:Ｂ鈍感 && ABL:Ｂ感覚 >= 3
	PRINTL Ｂ鈍感 +30%
	LOCAL += 30
ENDIF
IF TALENT:Ｂ敏感
	PRINTL Ｂ敏感 -10%
	LOCAL -= 10
ENDIF
SELECTCASE TALENT:バストサイズ
	;絶壁
	CASE 1
		PRINTL 絶壁 -20%
		LOCAL -= 20
	;貧乳
	CASE 2
		PRINTL 貧乳 -10%
		LOCAL -= 10
	;巨乳
	CASE 4
		PRINTL 巨乳 +20%
		LOCAL += 20
	;爆乳
	CASE 5
		PRINTL 爆乳 +30%
		LOCAL += 30
ENDSELECT
IF TALENT:回復早い
	PRINTL 回復早い -20%
	LOCAL -= 20
ENDIF
IF TALENT:回復遅い
	PRINTL 回復遅い +40%
	LOCAL += 40
ENDIF
IF TALENT:日光浴
	PRINTL 日光浴 -10%
	LOCAL -= 10
ENDIF
IF TALENT:月光浴
	PRINTL 月光浴 -10%
	LOCAL -= 10
ENDIF
IF TALENT:ふたなり
	PRINTL ふたなり +20%
	LOCAL += 20
ENDIF
IF SEX(TARGET) == 1
	PRINTL 男 +30%
	LOCAL += 30
ENDIF
IF TALENT:小人体型
	PRINTL 小人体型 +70%
	LOCAL += 70
ENDIF
IF TALENT:動物耳
	PRINTL 動物耳 +10%
	LOCAL += 10
ENDIF
IF TALENT:禁断の知識
	PRINTL 禁断の知識 +30%
	LOCAL += 30
ENDIF

IF TALENT:人気
	PRINTL 人気 +50%
	LOCAL += 50
ENDIF
IF TALENT:無機物
	PRINTL 無機物 +70%
	LOCAL += 70
ENDIF
IF TALENT:母乳体質
	PRINTL 母乳体質 +20%
	LOCAL += 20
ENDIF
IF TALENT:幼稚
	PRINTL 幼稚 -10%
	LOCAL -= 10
ENDIF
IF TALENT:絶倫
	PRINTL 絶倫 +20%
	LOCAL += 20
ENDIF
IF TALENT:母性
	PRINTL 母性 +30%
	LOCAL += 30
ENDIF
IF TALENT:羽
	PRINTL 羽 +10%
	LOCAL += 10
ENDIF
IF TALENT:リミットバースト
	PRINTL リミットバースト +300%
	LOCAL += 300
ENDIF

IF TALENT:寂しがり屋
	LOCAL -= 10
	PRINTL 寂しがり屋 -10%
ENDIF
IF TALENT:ファーリー
	LOCAL += 20
	PRINTL ファーリー +20%
ENDIF
IF TALENT:ナルシスト
	LOCAL -= 10
	PRINTL ナルシスト -10%
ENDIF
IF TALENT:潔癖症
	LOCAL += 20
	PRINTL 潔癖症 +20%
ENDIF
IF TALENT:男好き
	LOCAL -= 10
	PRINTL 男好き -10%
ENDIF
IF TALENT:女好き
	LOCAL -= 10
	PRINTL 女好き -10%
ENDIF
IF TALENT:同族嫌悪
	LOCAL += 30
	PRINTL 同族嫌悪 +30%
ENDIF
IF TALENT:ハイテンション
	LOCAL -= 10
	PRINTL ハイテンション -10%
ENDIF
IF TALENT:尻尾
	LOCAL += 10
	PRINTL 尻尾 +10%
ENDIF
IF TALENT:衝動的
	LOCAL -= 10
	PRINTL 衝動的 -10%
ENDIF
IF TALENT:買い物上手
	LOCAL -= 10
	PRINTL 買い物上手 -10%
ENDIF
IF TALENT:夢喰い
	LOCAL -= 10
	PRINTL 夢喰い -10%
ENDIF
IF TALENT:ネクロマンサー
	LOCAL += 10
	PRINTL ネクロマンサー +10%
ENDIF
IF TALENT:戦士
	LOCAL += 50
	PRINTL 戦士 +50%
ENDIF
IF TALENT:ドラゴン使い
	LOCAL += 20
	PRINTL ドラゴン使い +20%
ENDIF
IF TALENT:料理人
	LOCAL += 30
	PRINTL 料理人 +30%
ENDIF
IF TALENT:専業主婦
	LOCAL += 30
	PRINTL 専業主婦 +30%
ENDIF
IF TALENT:絶対音感
	LOCAL += 30
	PRINTL 絶対音感 +30%
ENDIF
IF TALENT:工学博士
	LOCAL += 30
	PRINTL 工学博士 +30%
ENDIF
IF TALENT:カメラマン
	LOCAL += 30
	PRINTL カメラマン +30%
ENDIF
IF TALENT:恋心
	LOCAL += 40
	PRINTL 恋心 +40%
ENDIF
IF TALENT:既婚者
	LOCAL += 80
	PRINTL 既婚者 +80%
ENDIF


;調教が進むと消えるマイナス素質（52:抑圧、54:抵抗）
IF CSVTALENT(NO:TARGET, 52)
	LOCAL += 30
	PRINTL 抑圧消滅済み +30%
ENDIF
IF CSVTALENT(NO:TARGET, 54)
	LOCAL += 30
	PRINTL 抵抗消滅済み +30%
ENDIF

;娼館で働かせた日数だけ倍率減
IF TALENT:傷物
	LOCAL -= TALENT:傷物
	PRINTFORML 傷物 -{TALENT:傷物}\%
ENDIF

PRINTFORML 素質倍率 = {LOCAL}\%
;補正値はどんなに低くても最低30%
IF LOCAL < 30
	PRINTL 最低保証 30%
	LOCAL = 30
ENDIF 
;補正値の適用
PRICE *= LOCAL
PRICE /= 100

SETCOLOR 100, 150, 250
PRINTFORML 能力価格×素質補正 = {PRICE}
RESETCOLOR

PRINTL 
LOCAL = 100
IF TALENT:崩壊
	PRINTL 崩壊 -20%
	LOCAL -= 20
ENDIF
IF TALENT:妊娠
	PRINTL 妊娠 -30%
	LOCAL -= 30
ENDIF
IF TALENT:狂気
	PRINTL 狂気 -30%
	LOCAL -= 30
ENDIF
IF TALENT:即落ち
	PRINTL 即落ち -80%
	LOCAL -= 80
ENDIF

SIF LOCAL != 100
	PRINTFORML 特殊素質補正 = {LOCAL}\%

IF LOCAL < 10
	PRINTFORML 最低保証10\%
	LOCAL = 10
ENDIF

PRICE *= LOCAL
PRICE /= 100

IF LOCAL != 100
	SETCOLOR 100, 150, 250
	PRINTFORML 価格×特殊素質補正 = {PRICE}
	RESETCOLOR
ENDIF

;難易度処理
SELECTCASE FLAG:難易度
	;NORMAL
	CASE 1
		PRINTFORML 難易度:NORMAL ×100\%
		TIMES PRICE , 1.00
	;HYPER
	CASE 2
		PRINTFORML 難易度:HYPER ×80\%
		TIMES PRICE , 0.80
	;ANOTHER
	CASE 3
		PRINTFORML 難易度:ANOTHER ×60\%
		TIMES PRICE , 0.60
ENDSELECT
SETCOLOR 100, 150, 250
PRINTFORML 価格×難易度補正 = {PRICE}
RESETCOLOR
;価格×種族補正
SELECTCASE CFLAG:種族
	;人間,人間(？),獣,その他
	CASE 1, 3, 20, 99
		LOCAL = 100
	;宇宙人,夢魔,獣人,人魚,吸血鬼
	CASE 2, 7, 15, 17, 21
		LOCAL = 120
	;改造人間,機械
	CASE 4, 16
		LOCAL = 105
	;精霊,ニンフ,妖精
	CASE 5, 8, 18
		LOCAL = 110
	;天使,守護者,鳳凰
	CASE 6, 11, 12
		LOCAL = 140
	;悪魔,魔術師,記録者
	CASE 9, 13, 14
		LOCAL = 130
	;神
	CASE 10
		LOCAL = 150
	;ゾンビ
	CASE 19
		LOCAL = 95
ENDSELECT

PRINTL 
SETCOLOR 100, 150, 250
PRINTFORML 価格×種族(%CSTR:種族%)補正:{LOCAL}\% = {PRICE*LOCAL/100}
RESETCOLOR
PRICE *= LOCAL
PRICE /= 100
PRINTL 

SETCOLOR 100, 150, 250
PRINTFORML 価格:${PRICE}＋元の価格:${CFLAG:価格} = {PRICE+CFLAG:価格}
RESETCOLOR
PRICE += CFLAG:価格
PRINTL 

;元助手
IF ISASSI:TARGET == 1
	PRINTFORML 助手経験あり -50\%
	TIMES PRICE , 0.50
ENDIF


DO
	;売却確認
	PRINTFORM %NAME:TARGET%は
	SETCOLOR 50, 150, 250
	PRINTFORM ${PRICE}
	RESETCOLOR
	PRINTL で売れそうです
	PRINTL 売却しますか？
	PRINTL [0] はい
	PRINTL [1] いいえ
	CFLAG:売却寸止め = 1
	INPUT
LOOP LOOPRES(0, 1)

SELECTCASE RESULT
	CASE 0
		;売却時のイベント口上
		CALL KOJO_MESSAGE_EVENT, 18
		;売却額
		PRINTFORMW 結果、%NAME:TARGET%は${PRICE}で売れました
		MONEY += PRICE
		LOCAL = TARGET
		TARGET = LOCALTARGET
		ASSI = LOCALASSI
		DELCHARA LOCAL
		SIF LOCAL == LOCALTARGET
			TARGET = -1
		SIF LOCAL == LOCALASSI
			ASSI = -1
		SIF LOCAL < LOCALTARGET
			TARGET--
		SIF LOCAL < LOCALASSI
			ASSI--
	CASE 1
		TARGET = LOCALTARGET
		RETURN 0
ENDSELECT

