@飲食店経営
#DIM DYNAMIC LCOUNT
#DIM DYNAMIC 増築費用

;増築費用は(部屋数+1)^2*100000(暫定)
増築費用 = POWER((ホテル部屋数+1), 2)*100000

CALL 飲食店ステータス
PRINTL 
;とりあえず最大部屋数は100部屋で
IF ホテル部屋数 >= 100
	CALL PRINTCOLORL, "[-] - 部屋数は最大です", "gray"
ELSE
	CALL PASELIL, @"　[1] - 宿泊施設の増築(費用:{増築費用}＄)"
ENDIF
PRINTL 　[2] - 温泉を探す
PRINTL 　[3] - 経営方針の管理
IF 飲食ジャンル != ""
	PRINTL 　[4] - メニューを変更
ELSE
	CALL PRINTCOLORL ,@"　[-] - %飲食店名%では料理の提供を行っていません", "gray"
ENDIF
SELECTCASE 業種
	CASE "ビジネスホテル", "リゾートホテル", "ラブホテル", "日帰り温泉", "ホストクラブ", "キャバクラ"
		PRINTL 　[5] - 基本料金を設定する
	CASE "日帰り温泉"
		CALL PASELIL, @"　[-] - 日帰り温泉は温泉レベル×100で料金固定({温泉レベル*100}＄)"
	CASEELSE
		CALL PRINTCOLORL, "　[-] - 現在の業種では基本料金の設定は不要です", "gray"
ENDSELECT
PRINTL 　[6] - 人員の管理
PRINTL 　[7] - リーダーを任命する
PRINTFORML 　[8] - \@ FLAG:飲食店営業中 == -1 ? 営業を再開する # 営業を休止する \@
PRINTL 　[9] - 定休日の設定
PRINTL 　[10] - 売上の詳細を確認
DRAWLINE
PRINTPLAIN 　飲食店・ホテル　
PRINTL [0] - 戻る

DO
	INPUT
	SELECTCASE RESULT
		CASE 0
			RETURN
		CASE 1
			SIF ホテル部屋数 >= 100
				CONTINUE
			IF MONEY < 増築費用
				PRINTW 所持金が足りません
				RESTART
			ENDIF
			CALL PASELIL, @"{増築費用}＄で部屋数を{ホテル部屋数+1}に増築します。よろしいですか？"
			PRINTL [0] - はい
			PRINTL [1] - いいえ
			DO
				INPUT
				IF RESULT == 0
					ホテル部屋数++
					MONEY -= 増築費用
				ENDIF
			LOOP LOOPRES(0, 1)
			RESTART
		CASE 2
			CALL 温泉探索
		CASE 3
			CALL 経営方針_飲食店
		CASE 4
			SIF 飲食ジャンル != ""
				CALL メニュー変更_飲食店
		CASE 5
			CALL 基本料金設定
		CASE 6
			CALL 人員管理_飲食店
		CASE 7
			DRAWLINE
			PRINTL □リーダーを選択してください
			FOR LCOUNT, 1, CHARANUM
				SIF CSTR:LCOUNT:配属 != "飲食店"
					CONTINUE
				PRINTFORML 　[{LCOUNT}] - %NAME:LCOUNT%
			NEXT
			DRAWLINE
			PRINTPLAIN 　リーダー任命　
			PRINTL [0] - 任命しない
			DO
				INPUT
				SELECTCASE RESULT
					CASE 0
						CVARSET 飲食店リーダー
						RESTART
					CASEELSE
						SIF CSTR:RESULT:配属 != "飲食店"
							CONTINUE
						CVARSET 飲食店リーダー
						飲食店リーダー:RESULT:0 = 1
						RESTART
				ENDSELECT
			LOOP 1
		CASE 8
			IF FLAG:飲食店営業中 > 0
				PRINTFORMW %飲食店名%の経営を一時中断しました
				;定休日じゃない休業は-1
				FLAG:飲食店営業中 = -1
			ELSE
				PRINTFORMW %飲食店名%の経営を開始しました
				FLAG:飲食店営業中 = DAY
			ENDIF
		CASE 9
			VARLINE = 0
			DO
				SIF VARLINE
					CLEARLINE LINECOUNT-VARLINE
				VARLINE = LINECOUNT
				LOCALS = 
				DRAWLINE
				PRINTL □定休日を選んでください
				PRINTFORML 　[1] - 日曜日（\@ INN定休日("日") ? 定休 # 営業 \@）
				PRINTFORML 　[2] - 月曜日（\@ INN定休日("月") ? 定休 # 営業 \@）
				PRINTFORML 　[3] - 火曜日（\@ INN定休日("火") ? 定休 # 営業 \@）
				PRINTFORML 　[4] - 水曜日（\@ INN定休日("水") ? 定休 # 営業 \@）
				PRINTFORML 　[5] - 木曜日（\@ INN定休日("木") ? 定休 # 営業 \@）
				PRINTFORML 　[6] - 金曜日（\@ INN定休日("金") ? 定休 # 営業 \@）
				PRINTFORML 　[0] - 土曜日（\@ INN定休日("土") ? 定休 # 営業 \@）
				PRINTL 　[9] - 設定終了
				INPUT
				LOCAL = RESULT
				SELECTCASE LOCAL
					CASE 0 TO 6
						FOR LCOUNT, 0, 7
							IF LOCAL == LCOUNT
								IF !INN定休日(DOW(LOCAL))
									飲食店定休日 += @"・%DOW(LOCAL)%"
								ELSE
									CONTINUE
								ENDIF
							ENDIF
							IF INN定休日(DOW(LCOUNT))
								IF LOCALS == ""
									LOCALS = %DOW(LCOUNT)%
								ELSE
									LOCALS += @"・%DOW(LCOUNT)%"
								ENDIF
							ENDIF
						NEXT
						飲食店定休日 = %LOCALS%
					CASE 9
						BREAK
				ENDSELECT
			LOOP 1
		CASE 10
			CALL 飲食店売上詳細
			RESTART
		CASEELSE
			CONTINUE
	ENDSELECT
	RESTART
LOOP 1


@宿泊施設増設_飲食店


PRINTL [1] - 温泉を探す
PRINTL [2] - 宿泊施設を増築する

DO
	INPUT
	SELECTCASE RESULT
		CASE 1
			CALL 温泉探索
			RETURN
	ENDSELECT
LOOP 1

@経営方針_飲食店
#DIM DYNAMIC 条件可否, 20
#DIM DYNAMIC 表示数
{
#DIMS DYNAMIC 業種名 = 
"飲食店",
"ビジネスホテル",
"リゾートホテル",
"ラブホテル",
"日帰り温泉",
"バー",
"ホストクラブ",
"キャバクラ"
}
;連携が必要な業種は保留
;"飲食店(裏)",
;"リゾートホテル(裏)",
;"ピンクサロン",
;"ライブハウス",

#DIM DYNAMIC LCOUNT

DRAWLINE
PRINTL □経営方針を設定します

IF 温泉レベル == 0
	CALL PRINTCOLORL, "　[-] - 温泉の併設(温泉設備が無いと併設できません)", "gray"
ELSE
	PRINTFORML 　[1] - 温泉の併設(\@ 温泉併設 ? 併設中 # 併設無し \@)
ENDIF
IF ホテル部屋数 == 0
	CALL PRINTCOLORL, "　[-] - 宿の併設(宿泊施設の増築を行わないと併設できません)", "gray"
	RESETCOLOR
ELSE
	PRINTFORML 　[2] - 宿の併設(\@ 宿併設 ? 併設中 # 併設無し \@)
ENDIF
;IF CMATCH(CSTR:配属, "娼館") == 0
;	CALL PRINTCOLORL, "　[-] - 娼館との連携(娼館に配属してるキャラが居ないと連携できません)", "gray"
;ELSE
;	PRINTL 　[3] - 娼館との連携
;ENDIF
;IF CMATCH(CSTR:配属, "芸能プロダクション") == 0
;	CALL PRINTCOLORL, "　[-] - 芸能プロダクションとの連携(芸プロの配属してるキャラが居ないと連携できません)", "gray"
;ELSE
;	PRINTL 　[4] - 芸能プロダクションとの連携
;ENDIF
SELECTCASE 業種
	CASE "ラブホテル", "日帰り温泉"
		CALL PRINTCOLORL, "　[-] - 料理のジャンル(提供無し)", "gray"
	CASE "バー", "ピンクサロン", "ライブハウス", "ホストクラブ", "キャバクラ"
		PRINTL 　[-] - 料理のジャンル(お酒で固定)
	CASEELSE
		PRINTFORML 　[5] - 料理のジャンル(現在:%飲食ジャンル%)
ENDSELECT

PRINTL 

PRINTFORML 　上記の条件から業種を選択 現在:%業種%
PRINT 　業種候補:

LCOUNT = 0
表示数 = 0
VARSET 条件可否

FOR LCOUNT, 0, VARSIZE("業種名")
	SELECTCASE 業種名:LCOUNT
		;無条件解放
		CASE "飲食店", "バー", "ホストクラブ", "キャバクラ"
			条件可否:LCOUNT = 1
		;宿泊施設あり
		CASE "ビジネスホテル", "ラブホテル"
			SIF 宿併設
				条件可否:LCOUNT = 1
		;宿泊施設+温泉
		CASE "リゾートホテル"
			SIF 宿併設 && 温泉併設
				条件可否:LCOUNT = 1
		;娼館との連携必須
		CASE "飲食店(裏)", "ピンクサロン"
			SIF 娼館連携
				条件可否:LCOUNT = 1
		;リゾートホテル+娼館連携
		CASE "リゾートホテル(裏)"
			SIF 娼館連携 && 宿併設 && 温泉併設
				条件可否:LCOUNT = 1
		;温泉あり
		CASE "日帰り温泉"
			SIF 温泉併設
				条件可否:LCOUNT = 1
		;芸プロとの連携
		CASE "ライブハウス"
			SIF 芸プロ連携
				条件可否:LCOUNT = 1
	ENDSELECT
	IF !条件可否:LCOUNT
		SETCOLORBYNAME gray
		PRINTPLAINFORM [--]%業種名:LCOUNT% 
	ELSE
		PRINTFORM [{LCOUNT+20}]%業種名:LCOUNT% 
	ENDIF
	表示数++
	IF 表示数%5 == 0 && 表示数
		PRINTL 
		PRINTPLAIN 　　　　　 
	ENDIF
	RESETCOLOR
NEXT

SIF !LINEISEMPTY()
	PRINTL 

DRAWLINE
PRINTPLAIN 　経営方針(飲食店)　
PRINTL [0] - 戻る

DO
	INPUT
	SELECTCASE RESULT
		CASE 0
			RETURN
		CASE 1
			INVERTBIT 温泉併設, 0
			RESTART
		CASE 2
			INVERTBIT 宿併設, 0
			RESTART
		CASE 5
			PRINTL □ジャンルを選んでください
			PRINTL 　[1] - 和食
			PRINTL 　[2] - 洋食
			PRINTL 　[3] - 中華
			PRINTL 　[4] - スイーツ
			PRINTL 　[5] - ファストフード
			PRINTL 　[6] - お酒
			PRINTL 　[0] - 無し
			DO
				INPUT
				SELECTCASE RESULT
					CASE 0
						飲食ジャンル = 
					CASE 1
						飲食ジャンル = 和食
					CASE 2
						飲食ジャンル = 洋食
					CASE 3
						飲食ジャンル = 中華
					CASE 4
						飲食ジャンル = スイーツ
					CASE 5
						飲食ジャンル = ファストフード
					CASE 6
						飲食ジャンル = お酒
					CASEELSE
						CONTINUE
				ENDSELECT
			LOOP 0
		CASE 20 TO 40
			SIF 業種名:(RESULT-20) == ""
				CONTINUE
			SIF !条件可否:(RESULT-20)
				CONTINUE
			業種 = %業種名:(RESULT-20)%
			;デフォルト名のままなら業種に合わせて店名変更
			SIF MATCH(業種名, 飲食店名) || 飲食店名 == ""
				飲食店名 = %業種%
			SELECTCASE 業種
				;酒がメインのサービスなら酒で固定
				CASE "バー", "ピンクサロン", "ライブハウス", "ホストクラブ", "キャバクラ"
					飲食ジャンル = お酒
				;飲食物を提供しない店
				CASE "日帰り温泉", "ラブホテル"
					飲食ジャンル = 
			ENDSELECT
	ENDSELECT
	RESTART
LOOP 1

@メニュー変更_飲食店
#DIM DYNAMIC LCOUNT

DRAWLINE

PRINTFORML □現在の業種:%業種% ジャンル:%飲食ジャンル% 価格倍率:{飲食店価格倍率/10}.{飲食店価格倍率%10}

FOR LCOUNT, 0, 10
	IF 飲食店メニュー:LCOUNT == ""
		PRINTFORML 　[{LCOUNT}] - メニュー無し
	ELSE
		CALLF レシピ判定, 飲食店メニュー:LCOUNT
		SPLIT 料理ジャンル, "/", LOCALS
		SIF MATCH(LOCALS, 飲食ジャンル)
			SETCOLORBYNAME lime
		CALL PASELIL, @"　[{LCOUNT}] - %飲食店メニュー:LCOUNT, 28, LEFT% {(料理価格*飲食店価格倍率)/10, 4}＄\@ 料理原価 ? (原価:{料理原価}＄) # \@ \@ 新鮮食材 ? 新鮮食材:{新鮮食材}個 # \@"
		RESETCOLOR
	ENDIF
NEXT
PRINTL 　※緑色はお店のジャンルに沿ったメニュー
DRAWLINE
PRINTPLAIN 　メニュー変更　
PRINTL [10] - 戻る [11] - 価格の倍率を変える [12] - メニューをリセットする

DO
	INPUT
	SELECTCASE RESULT
		CASE 10
			RETURN
		CASE 11
			CALL TWO_DIGIT, 100, "×10(%)", 1
			飲食店価格倍率 = RESULT
			RESTART
		CASE 12
			VARSET 飲食店メニュー
			RESTART
		CASE 0 TO 9
			CALL レシピ選択_飲食店, RESULT
			RESTART
	ENDSELECT
LOOP 1

@レシピ選択_飲食店, メニュー番号
#DIM DYNAMIC LCOUNT
#DIM DYNAMIC メニュー番号
#DIM DYNAMIC ページ数
#DIM DYNAMIC 次ページあり

DRAWLINE
PRINTL □料理を選んでください
FOR LCOUNT, (ページ数*20)+1, (ページ数*20)+21
	SIF LCOUNT >= VARSIZE("料理メニュー")
		BREAK
	SIF 料理メニュー:LCOUNT == ""
		CONTINUE
	CALLF レシピ判定, 料理メニュー:LCOUNT
	CALL PASELIL, @"　[{LCOUNT, 3}]%料理メニュー:LCOUNT, 28, LEFT% ジャンル:%料理ジャンル, 28, LEFT% 価格:{(料理価格*飲食店価格倍率)/10, 4}＄\@ 料理原価 ? (原価:{料理原価, 3}＄) # \@ \@ 新鮮食材 ? 新鮮食材:{新鮮食材}個 # \@"
NEXT

次ページあり = 0
SIF 料理メニュー:(LCOUNT+1) != ""
	次ページあり = 1

DRAWLINE
PRINTPLAIN 　レシピ一覧　
IF ページ数
	PRINT [-1] - 前ページ 
ELSE
	PRINTPLAIN 　　　　　　　  
ENDIF
PRINT [0] - 戻る 
SIF 次ページあり
	PRINT [-2] - 次ページ 
PRINTL [-3] - メニュー無し

DO
	INPUT
	SELECTCASE RESULT
		CASE 0
			RETURN
		CASE -1
			SIF ページ数
				ページ数--
			RESTART
		CASE -2
			SIF 次ページあり
				ページ数++
			RESTART
		CASE -3
			飲食店メニュー:メニュー番号 = 
			RETURN
		CASE 1 TO VARSIZE("料理メニュー")-1
			SIF 料理メニュー:RESULT == ""
				CONTINUE
			飲食店メニュー:メニュー番号 = %料理メニュー:RESULT%
			RETURN
	ENDSELECT
LOOP 1

@基本料金設定

SELECTCASE 業種
ENDSELECT

@人員管理_飲食店

DRAWLINE

;連携する業種ではそちらから追加で配属できる
SELECTCASE 業種
	CASE "飲食店(裏)", "リゾートホテル(裏)", "ピンクサロン"
		SIF CMATCH(CSTR:配属, "娼館") == 0
			GOTO ELSE
		PRINTL □人員を配属します
		PRINTFORML 　[1] - 娼館からの配属(現在:{CMATCH(CSTR:転属, "飲食店")}人/3人)
	CASE "ライブハウス"
		SIF CMATCH(CSTR:配属, "芸能プロダクション") == 0
			GOTO ELSE
		PRINTL □人員を配属します
		PRINTFORML 　[1] - 芸プロからの配属(現在:{CMATCH(CSTR:転属, "飲食店")}人/3人)
	CASEELSE
		$ELSE
		CALL STRATEGY_PERSONAL, "飲食店"
		RETURN
ENDSELECT
PRINTFORML 　[2] - 通常の配属(現在:{CMATCH(CSTR:配属, "飲食店")}人/{飲食店配属上限()}人)
PRINTL 　[0] - 戻る

DO
	INPUT
	SELECTCASE RESULT
		CASE 0
			RETURN
		CASE 1
			SELECTCASE 業種
				CASE "飲食店(裏)", "リゾートホテル(裏)", "ピンクサロン"
					CALL 転属_飲食店, "娼館"
				CASE "ライブハウス"
					CALL 転属_飲食店, "芸プロ"
			ENDSELECT
			RESTART
		CASE 2
			CALL STRATEGY_PERSONAL
			RESTART
	ENDSELECT
LOOP 1

@転属_飲食店, ARGS
#DIM DYNAMIC LCOUNT

DRAWLINE
PRINTFORML □%飲食店名%に転属するキャラを選択してください(本業の配属は解除されません)

FOR LCOUNT, 1, CHARANUM
	SELECTCASE ARGS
		CASE "娼館"
			SIF CSTR:LCOUNT:配属 != "娼館"
				CONTINUE
			PRINTFORML 　[{LCOUNT, 2}] - %NAME:LCOUNT%\@ CSTR:LCOUNT:転属 == "飲食店" ? (転属中) # \@
		CASE "芸プロ"
			SIF CSTR:LCOUNT:配属 != "芸能プロダクション"
				CONTINUE
			PRINTFORML 　[{LCOUNT, 2}] - %NAME:LCOUNT%\@ CSTR:LCOUNT:転属 == "飲食店" ? (転属中) # \@
	ENDSELECT
NEXT
DRAWLINE
PRINTPLAIN 　転属　
PRINTL [0] - 戻る

DO
	INPUT
	SELECTCASE RESULT
		CASE 0
			RETURN
		CASE 1 TO CHARANUM-1
			SELECTCASE ARGS
				CASE "娼館"
					SIF CSTR:RESULT:配属 != "娼館"
						CONTINUE
				CASE "芸プロ"
					SIF CSTR:RESULT:配属 != "芸能プロダクション"
						CONTINUE
			ENDSELECT
			IF CSTR:RESULT:転属 == "飲食店"
				CSTR:RESULT:転属 = 
			ELSE
				CSTR:RESULT:転属 = 飲食店
			ENDIF
			RESTART
	ENDSELECT
LOOP 1

@飲食店配属上限
#FUNCTION

;業種によって配属上限人数が違う
SELECTCASE 業種
	CASE "ラブホテル", "日帰り温泉"
		RETURNF 3
	CASE "リゾートホテル", "リゾートホテル(裏)"
		RETURNF 10
	;それ以外は全部5人
	CASEELSE
		RETURNF 5
ENDSELECT

@飲食店ステータス

SIF 飲食店名 == ""
	飲食店名 = 飲食店

SIF FINDCHARA(飲食店リーダー, 1)  == -1
	飲食店リーダー:MASTER:0 = 1

PRINTFORM □%飲食店名%のステータス
IF FLAG:飲食店営業中
	IF INN定休日()
		PRINTL (本日定休日)
	ELSE
		PRINTL (営業中)
	ENDIF
ELSE
	PRINTL (休業中)
ENDIF
PRINTFORML 　飲食業の名声:{飲食店名声} ホテル業の名声:{ホテル名声}
PRINTFORM 　現在の業種:%業種%
SELECTCASE 業種
	CASE "飲食店"
		PRINT (食事の提供) 
	CASE "ビジネスホテル"
		PRINT (宿泊施設と軽食の提供) 
	CASE "リゾートホテル"
		PRINT (温泉と宿泊施設及び食事の提供) 
	CASE "飲食店(裏)"
		PRINT (食事とその他のサービスの提供) 
	CASE "リゾートホテル(裏)"
		PRINT (宿泊施設と併設された多数の娯楽及び食事の提供) 
	CASE "ラブホテル"
		PRINT (宿泊施設のみの提供) 
	CASE "日帰り温泉"
		PRINT (入浴を目的とした施設を提供) 
	CASE "バー"
		PRINT (アルコール類と軽食の提供) 
	CASE "ピンクサロン"
		PRINT (アルコール類とその他サービスの提供) 
	CASE "ライブハウス"
		PRINT (アルコール類と軽食、魂を揺さぶるメロディの提供) 
	CASE "ホストクラブ", "キャバクラ"
		PRINT (アルコール類と軽食、至福のひとときを提供) 
ENDSELECT
SELECTCASE 業種
	CASE "ビジネスホテル", "リゾートホテル", "リゾートホテル(裏)", "ラブホテル"
		PRINTFORM 支配人:%NAME:(FINDCHARA(飲食店リーダー, 1))%
	CASE "日帰り温泉"
		PRINTFORM 番頭:%NAME:(FINDCHARA(飲食店リーダー, 1))%
	CASE "バー"
		PRINTFORM マスター:%NAME:(FINDCHARA(飲食店リーダー, 1))%
	CASEELSE
		PRINTFORM 店長:%NAME:(FINDCHARA(飲食店リーダー, 1))%
ENDSELECT
PRINTL 

CALL PASELIL, @"　所持金:{MONEY}＄ 前日の売上:{飲食店売上:0}＄"
PRINTFORML 　定休日:\@ 飲食店定休日 == "" ? 無し # %飲食店定休日% \@
PRINTL □設備等
IF 温泉レベル == 0
	PRINT 　[温泉無し]
ELSE
	PRINTFORM 　[温泉レベル:{温泉レベル}]
ENDIF
IF ホテル部屋数 == 0
	PRINT [宿泊施設無し]
ELSE
	PRINTFORM [宿泊施設:{ホテル部屋数}室]
ENDIF 
;IF 娼館連携
;	PRINT [娼館と連携中]
;ELSE
;	PRINT [娼館との連携無し]
;ENDIF
;IF 芸プロ連携
;	PRINT [芸プロと連携中]
;ELSE
;	PRINT [芸プロとの連携無し]
;ENDIF
PRINTL 

;引数で指定した曜日が定休日かどうか 省略すれば今日の曜日
;書式 INN定休日("木") みたいな
@INN定休日, ARGS
#FUNCTION
VARSET LOCALS

SIF ARGS == ""
	ARGS = %DOW(FLAG:曜日)%

SPLIT 飲食店定休日, "・", LOCALS

IF FINDELEMENT(LOCALS, ARGS) >= 0
	RETURNF 1
ELSE
	RETURNF 0
ENDIF

@INCOME_飲食店
#DIM DYNAMIC LCOUNT
#DIM DYNAMIC LCOUNT2
#DIM DYNAMIC 世話好き人数
#DIM DYNAMIC 料理レベル
#DIM DYNAMIC 接客レベル
#DIM DYNAMIC 収入
#DIM DYNAMIC 支出
#DIM DYNAMIC モチベ計算用
#DIM DYNAMIC 素質
#DIM DYNAMIC 来客数
#DIM DYNAMIC グループ数
#DIM DYNAMIC 注文数, 10
#DIM DYNAMIC 最高価格
#DIM DYNAMIC 最低価格
#DIM DYNAMIC 平均価格
#DIM DYNAMIC メニュー数
#DIM DYNAMIC 基本料金
#DIM DYNAMIC 名声上昇値

基本料金 = 飲食店基本料金

CALL CHECKDRAWLINE

FOR LCOUNT, 1, CHARANUM
	SIF CSTR:LCOUNT:配属 != "飲食店" && CSTR:LCOUNT:転属 != "飲食店"
		CONTINUE
	SIF !CFLAG:LCOUNT:配属完了
		CONTINUE
	;サボり魔は25%の確率でサボる
	IF TALENT:LCOUNT:サボり魔 && RAND:4 == 0
		PRINTFORML %CALLNAME:LCOUNT%は%飲食店名%の仕事をサボりました
		CFLAG:LCOUNT:サボり = 1
		CONTINUE
	ENDIF
	;料理レベル計算 料理人だと+2
	料理レベル += ABL:LCOUNT:料理技能
	SIF TALENT:LCOUNT:料理人
		料理レベル += 2
	
	;接客レベル計算 ゲーセンとほぼ同じ
	IF FINDCHARA(CFLAG:ゲーセン店長, 1) >= 0 && TALENT:FINDCHARA(飲食店リーダー, 1):統率 && !TALENT:LCOUNT:統率
		接客レベル += (ABL:LCOUNT:従順+2)/5
		接客レベル += (ABL:LCOUNT:奉仕精神+2)/5
	ELSEIF 統率者("飲食店") && !TALENT:LCOUNT:統率
		接客レベル += (ABL:LCOUNT:従順+1)/5
		接客レベル += (ABL:LCOUNT:奉仕精神+1)/5
	ELSE
		接客レベル += ABL:LCOUNT:従順/5
		接客レベル += ABL:LCOUNT:奉仕精神/5
	ENDIF
	FOR 素質, 0, VARSIZE("TALENT")
		SIF !TALENT:LCOUNT:素質
			CONTINUE
		SELECTCASE TALENTNAME:素質
			CASE "生意気", "反抗的", "衝動的", "同族嫌悪", "崩壊"
				接客レベル -= 2
			{
			CASE "プライド高い", "無関心", "男嫌い", "女嫌い", "汚れ無視", "倒錯的", 
					"臆病", "保守的", "恥じらい", "大人しい", "寂しがり屋"
			}
				接客レベル -= 1
			CASE "素直", "自制心", "献身的", "気丈", "潔癖症", "料理人"
				接客レベル += 3
		ENDSELECT
	NEXT
	;-ストレス/100
	接客レベル -= CFLAG:LCOUNT:ストレス値/100
NEXT


;業種によって客数と客単価が変動する
SELECTCASE 業種
	CASE "飲食店"
		;各メニューの最高価格と最低価格を見る
		FOR LCOUNT, 0, 10
			SIF 飲食店メニュー:LCOUNT == ""
				CONTINUE
			CALLF レシピ判定, 飲食店メニュー:LCOUNT
			メニュー数++
			CALL SETMIN, 最低価格, 料理価格*飲食店価格倍率/10
			CALL SETMAX, 最高価格, 料理価格*飲食店価格倍率/10
			平均価格 += 料理価格*飲食店価格倍率/10
		NEXT
		平均価格 /= メニュー数
		;平均価格と名声で来客数が変動する 同値で約10人とし、あとは価格と反比例する(=名声に比例)
		来客数 = (飲食店名声*10)/平均価格
		;10%のゆらぎを与える
		来客数 += RAND(-来客数/10, (来客数/10)+1)
		;休日は20%増える
		SELECTCASE DOW(FLAG:曜日)
			CASE "土", "日"
				TIMES 来客数, 1.20
		ENDSELECT
		;最低10人は保証する
		CALL SETMAX, 来客数, 10
		;各メニューの注文数を計算する
		;基本的にどれかは出る
		DO
			LOCAL = RAND:10
			$RECIPELOOP飲食店
			IF 飲食店メニュー:LOCAL == ""
				LOCAL++
				SIF LOCAL == 10
					LOCAL = 0
				GOTO RECIPELOOP飲食店
			ENDIF
			注文数:LOCAL++
		LOOP SUMARRAY(注文数) < 来客数
		FOR LCOUNT, 0, 10
			SIF 飲食店メニュー:LCOUNT == ""
				CONTINUE
			CALLF レシピ判定, 飲食店メニュー:LCOUNT
			SPLIT 料理ジャンル, "/", LOCALS

			;料理レベルに応じてこの追加注文処理を再度行う(合計料理レベル%の確率)
			REPEAT 1+RANDPER(料理レベル)
				;店のジャンルに合ってる場合は3割くらいが追加注文する
				SIF MATCH(LOCALS, 飲食ジャンル)
					注文数:LCOUNT += RAND(来客数/5, (来客数/3)+1)
				;飲食店だと主食が出やすい
				SIF 料理分類:FINDELEMENT(料理メニュー, 飲食店メニュー:LCOUNT) == "主食"
					注文数:LCOUNT += RAND(来客数/5, (来客数/3)+1)
			REND
		NEXT
		;各注文数に応じて売上と支出が変動
		ARRAYSHIFT メニュー売上, 10, ""
		FOR LCOUNT, 0, 10
			SIF 注文数:LCOUNT == 0
				CONTINUE
			CALLF レシピ判定, 飲食店メニュー:LCOUNT
			収入 += (料理価格*飲食店価格倍率/10)*注文数:LCOUNT
			支出 += 料理原価*注文数:LCOUNT
			メニュー売上:LCOUNT '= @"%飲食店メニュー:LCOUNT%×{注文数:LCOUNT} 合計:{(料理価格*飲食店価格倍率/10)*注文数:LCOUNT}＄"
		NEXT
	CASE "ビジネスホテル", "リゾートホテル"
		;基本料金と名声で来客数が変動する 同値で約1組とし、あとは価格と反比例する(=名声に比例)
		グループ数 = ホテル名声/基本料金
		;休日は20%増える
		SELECTCASE DOW(FLAG:曜日)
			CASE "土", "日"
				TIMES グループ数, 1.20
		ENDSELECT
		;最低1組は保証する
		CALL SETMAX, グループ数, 1
		;ただし部屋数以上にはならない
		CALL SETMIN, グループ数, ホテル部屋数
		;1グループごとに客数が違う ビジホならほぼお一人様
		SELECTCASE 業種
			CASE "リゾートホテル"
				REPEAT グループ数
					来客数++
					SIF RANDPER(90)
						来客数++
					SIF RANDPER(50)
						来客数++
					SIF RANDPER(30)
						来客数++
					SIF RANDPER(10)
						来客数++
				REND
			CASE "ビジネスホテル"
				REPEAT グループ数
					来客数++
					SIF RANDPER(5)
						来客数++
				REND
		ENDSELECT
		;客単価は基本料金だが、たまに追加注文などある
		収入 = 基本料金*来客数
		収入 += RAND:(来客数/10+1)*平均価格
	CASE "ホストクラブ", "キャバクラ"
		;基本料金と名声で来客数が変動する 同値で約5人とし、あとは価格と反比例する(=名声に比例)
		来客数 = (飲食店名声*5)/基本料金
		;10%のゆらぎを与える
		来客数 += RAND(-来客数/5, (来客数/5)+1)
		;休日は20%増える
		SELECTCASE DOW(FLAG:曜日)
			CASE "土", "日"
				TIMES 来客数, 1.20
		ENDSELECT
		;最低3人は保証する
		CALL SETMAX, 来客数, 3
		;各メニューの注文数を計算する
		FOR LCOUNT, 0, 10
			SIF 飲食店メニュー:LCOUNT == ""
				CONTINUE
			CALLF レシピ判定, 飲食店メニュー:LCOUNT
			SPLIT 料理ジャンル, "/", LOCALS

			;お酒でも出るときと出ないときある
			SIF MATCH(LOCALS, "お酒")
				注文数:LCOUNT += RAND(来客数/2, 来客数+1)
		NEXT
		;各注文数に応じて売上と支出が変動
		ARRAYSHIFT メニュー売上, 10, ""
		FOR LCOUNT, 0, 10
			SIF 注文数:LOCAL == 0
				CONTINUE
			CALLF レシピ判定, 飲食店メニュー:LCOUNT
			収入 += (料理価格*飲食店価格倍率/10)*注文数:LCOUNT
			支出 += 料理原価*注文数:LCOUNT
			メニュー売上:LCOUNT '= @"%飲食店メニュー:LCOUNT%×{注文数:LCOUNT} 合計:{(料理価格*飲食店価格倍率/10)*注文数:LCOUNT}＄"
		NEXT
	CASE "バー"
		;各メニューの最高価格と最低価格を見る
		FOR LCOUNT, 0, 10
			SIF 飲食店メニュー:LCOUNT == ""
				CONTINUE
			CALLF レシピ判定, 飲食店メニュー:LCOUNT
			メニュー数++
			CALL SETMIN, 最低価格, 料理価格*飲食店価格倍率/10
			CALL SETMAX, 最高価格, 料理価格*飲食店価格倍率/10
			平均価格 += 料理価格*飲食店価格倍率/10
		NEXT
		平均価格 /= メニュー数
		;平均価格と名声で来客数が変動する 同値で約5人とし、あとは価格と反比例する(=名声に比例)
		来客数 = (飲食店名声*5)/平均価格
		;10%のゆらぎを与える
		来客数 += RAND(-来客数/5, (来客数/5)+1)
		;休日は20%増える
		SELECTCASE DOW(FLAG:曜日)
			CASE "土", "日"
				TIMES 来客数, 1.20
		ENDSELECT
		;最低5人は保証する
		CALL SETMAX, 来客数, 5
		;各メニューの注文数を計算する
		;基本的にどれかは出る
		DO
			LOCAL = RAND:10
			$RECIPELOOPバー
			IF 飲食店メニュー:LOCAL == ""
				LOCAL++
				SIF LOCAL == 10
					LOCAL = 0
				GOTO RECIPELOOPバー
			ENDIF
			注文数:LOCAL++
		LOOP SUMARRAY(注文数) < 来客数
		FOR LCOUNT, 0, 10
			SIF 飲食店メニュー:LCOUNT == ""
				CONTINUE
			CALLF レシピ判定, 飲食店メニュー:LCOUNT
			SPLIT 料理ジャンル, "/", LOCALS

			;料理レベルに応じてこの追加注文処理を再度行う(合計料理レベル%の確率)
			REPEAT 1+RANDPER(料理レベル)
				;店のジャンルに合ってる場合は3割くらいが追加注文する
				SIF MATCH(LOCALS, 飲食ジャンル)
					注文数:LCOUNT += RAND(来客数/5, (来客数/3)+1)
				;バーだとファストフードが出やすい傾向にある
				SIF MATCH(LOCALS, "ファストフード")
					注文数:LCOUNT += RAND(来客数/5, (来客数/3)+1)
			REND
		NEXT
		;各注文数に応じて売上と支出が変動
		ARRAYSHIFT メニュー売上, 10, ""
		FOR LCOUNT, 0, 10
			SIF 注文数:LOCAL == 0
				CONTINUE
			CALLF レシピ判定, 飲食店メニュー:LCOUNT
			収入 += (料理価格*飲食店価格倍率/10)*注文数:LCOUNT
			支出 += 料理原価*注文数:LCOUNT
			メニュー売上:LCOUNT '= @"%飲食店メニュー:LCOUNT%×{注文数:LCOUNT} 合計:{(料理価格*飲食店価格倍率/10)*注文数:LCOUNT}＄"
		NEXT
	CASE "ラブホテル"
		;基本料金と名声で来客数が変動する 同値で約5組とし、あとは価格と反比例する(=名声に比例)
		グループ数 = (その他業種名声*5)/基本料金
		;10%のゆらぎを与える
		グループ数 += RAND(-グループ数/5, (グループ数/5)+1)
		;休日は20%増える
		SELECTCASE DOW(FLAG:曜日)
			CASE "土", "日"
				TIMES 来客数, 1.20
		ENDSELECT
		;最低3組は保証する
		CALL SETMAX, グループ数, 3
		;だいたい2人で来るが極稀に人数が増える
		REPEAT グループ数
			来客数 += 2
			SIF RANDPER(5)
				来客数++
		REND
		;客単価は基本料金
		収入 = 基本料金*来客数
	CASE "日帰り温泉"
		;名声で来客数が変動する 名声/50人
		来客数 = 飲食店名声/50
		;休日は20%増える
		SELECTCASE DOW(FLAG:曜日)
			CASE "土", "日"
				TIMES 来客数, 1.20
		ENDSELECT
		;最低10人は保証する
		CALL SETMAX, 来客数, 10
		;客単価は単純 温泉レベル*30
		収入 = 温泉レベル*30*来客数
ENDSELECT


;モチベーションと人件費を計算する こちらもゲーセンとほぼ同じ
FOR LCOUNT, 1, CHARANUM
	SIF CSTR:LCOUNT:配属 != "飲食店"
		CONTINUE
	;配属完了にする
	IF !CFLAG:LCOUNT:配属完了
		CFLAG:LCOUNT:配属完了 = 1
		CONTINUE
	ENDIF
	モチベ計算用 = 0
	FOR LCOUNT2, 0, VARSIZE("TALENT")
		SIF !TALENT:LCOUNT:LCOUNT2
			CONTINUE
		SELECTCASE TALENTNAME:LCOUNT2
			CASE "恋慕", "服従"
				モチベ計算用++
			CASE "親愛", "隷属"
				モチベ計算用 += 2
			CASE "素直", "冷静", "強気", "好奇心", "目立ちたがり", "恥薄い", "献身的", "潔癖症", "料理人"
				モチベ計算用++
			CASE "臆病", "プライド高い", "大人しい", "無関心", "恥じらい", "汚臭敏感", "男嫌い", "女嫌い"
				モチベ計算用--
		ENDSELECT
	NEXT
	LOCAL = CFLAG:LCOUNT:モチベーション+モチベ計算用+世話好き人数
	SIF TALENT:LCOUNT:世話好き
		LOCAL -= 世話好き人数
	;配属先のキャラの相性で計算
	LOCAL += 相性モチベ補正(LCOUNT)
	CFLAG:LCOUNT:モチベーション = LIMIT(LOCAL, 1, 100)

	;宿を併設してると1部屋につき1万
	SIF 宿併設
		支出 += ホテル部屋数
	;温泉併設してると温泉レベル*100
	SIF 温泉併設
		支出 += 温泉レベル*100
	;もともとの収入を高めに見積もるので時給1000円くらいだと計算する
	;メニュー価格の倍率が1以上ならそれに比例する
	LOCAL = 8000
	SIF 飲食店価格倍率 > 10
		LOCAL = LOCAL*飲食店価格倍率/10
	;浪費癖だとさらに1.2倍
	SIF TALENT:LCOUNT:浪費癖
		TIMES LOCAL, 1.20
	支出 += LOCAL
	;実務経験を加算
	EXP:LCOUNT:実務経験++
NEXT

CALL PASELIL, @"%飲食店名%には{来客数}人の客が訪れ、{収入}＄の収入と{支出}＄の支出がありました"
名声上昇値 = 接客レベル+来客数
SELECTCASE 業種
	CASE "ビジネスホテル", "リゾートホテル", "ラブホテル"
		PRINTFORML ホテル名声が{名声上昇値}、飲食店名声とその他業種名声が{名声上昇値/10}上昇しました
		ホテル名声 += 名声上昇値
		飲食店名声 += 名声上昇値/10
		その他業種名声 += 名声上昇値/10
	CASE "飲食店", "バー", "ホストクラブ", "キャバクラ"
		PRINTFORML 飲食店名声が{名声上昇値}、ホテル名声とその他業種名声が{名声上昇値/10}上昇しました
		ホテル名声 += 名声上昇値/10
		飲食店名声 += 名声上昇値
		その他業種名声 += 名声上昇値/10
	CASEELSE
		PRINTFORML そのた業種名声が{名声上昇値}、飲食店名声とホテル名声が{名声上昇値/10}上昇しました
		ホテル名声 += 名声上昇値/10
		飲食店名声 += 名声上昇値/10
		その他業種名声 += 名声上昇値
ENDSELECT
WAIT

ARRAYSHIFT 飲食店売上, 1, 0
ARRAYSHIFT 飲食店客数, 1, 0
ARRAYSHIFT 飲食店支出, 1, 0
飲食店売上 = 収入
飲食店客数 = 来客数
飲食店支出 = 支出

@飲食店売上詳細
#DIM DYNAMIC 年
#DIM DYNAMIC 月
#DIM DYNAMIC 日
#DIM DYNAMIC 利用年, 7
#DIM DYNAMIC 利用月, 7
#DIM DYNAMIC 利用日, 7
#DIM DYNAMIC LCOUNT
#DIM DYNAMIC ページ

;一週間遡ってその日時を入れておく
年 = YEAR
月 = MONTH
日 = DAYS
FOR LCOUNT, 0, 7
	DO
		日--
		IF 日 <= 0
			月--
			IF 月 <= 0
				年--
				月 = 12
			ENDIF
			日 = 31
		ENDIF
	LOOP !EXIST_DAY(年, 月, 日)
	利用年:LCOUNT = 年
	利用月:LCOUNT = 月
	利用日:LCOUNT = 日
NEXT

PRINTFORML □{利用年:ページ}年{利用月:ページ}月{利用日:ページ}日の売上詳細
FOR LCOUNT, ページ*10, ページ*10+10
	SIF メニュー売上:LCOUNT == ""
		CONTINUE
	CALL PASELIL, @"　%メニュー売上:LCOUNT%"
NEXT
PRINTFORML 　来客数:{飲食店客数:ページ} 売上:{飲食店売上:ページ} 客単価:{飲食店売上:ページ/飲食店客数:ページ} 支出:{飲食店支出:ページ}
DRAWLINE
PRINTPLAIN 　売上詳細　
IF ページ > 0
	PRINT [1] - 前ページ 
ELSE
	PRINTPLAIN 　　　　　　　 
ENDIF
PRINT [0] - 戻る 
SIF ページ < 6
	PRINT [9] - 次ページ
PRINTL 

DO
	INPUT
	SELECTCASE RESULT
		CASE 0
			RETURN
		CASE 1
			SIF ページ > 0
				ページ--
			RESTART
		CASE 9
			SIF ページ < 6
				ページ++
				RESTART
	ENDSELECT
LOOP 1




