@USERCOM_ABLE_魔法詠唱, ARG
#FUNCTION
;ゲーセンに居る場合はできない
SIF TEQUIP:ゲームセンター
	RETURNF 0
;上級売春中も不可能（暫定）
SIF 上級売春中
	RETURNF 0
;PLAYERが魔術師じゃないとできない
SIF !TALENT:PLAYER:魔術師
	RETURNF 0

COMRESULT = 1
RETURNF 1

@COM_魔法詠唱
#DIM DYNAMIC スキル
スキル = ABL:PLAYER:魔法技能
DRAWLINE
PRINTFORML □魔法一覧 詠唱者:%NAME:PLAYER% 魔法技能LV{スキル}
PRINTFORML 　%NAME:PLAYER%の魔力%BARSTR(BASE:PLAYER:魔力, MAXBASE:PLAYER:魔力, 32)%({BASE:PLAYER:魔力}/{MAXBASE:PLAYER:魔力})
IF TALENT:魔術師
	SIF RELATION:PLAYER:(NO:TARGET) >= 150 && RELATION:TARGET:(NO:PLAYER) >= 150
		PRINTFORML 　[ 1] - 魔力吸収 唇を介して魔力を受け取る 相性が良くないと実行不可（150％）
	PRINTFORML 　[ 2] - 魔力譲与 唇を介して魔力を与える 相性が良いほど効率が良い（最高200％）
ENDIF
LOCAL = 魔力消費量(3, スキル)/3
;Heatstroke
PRINTFORML 　[ 3] - ヒートストローク（魔力消費量 {LOCAL}）
PRINTL 　　　　 気温が高いほど実効値上昇
;WHITE OUT
PRINTFORML 　[ 4] - ホワイトアウト（魔力消費量 {LOCAL}）
PRINTL 　　　　 気温が低いほど実効値上昇
IF スキル >= 4
	LOCAL = 魔力消費量(4, スキル)/3
	;リカーシブファンクション
	PRINTFORML 　[ 5] - リカーシブファンクション（魔力消費量 {LOCAL}）
	PRINTL 　　　　 コマンド連続実行によるデメリットが発生しなくなる
	;魚氷に上り 耀よひて
	PRINTFORML 　[ 6] - ニコニコサンフラワーキッス（魔力消費量 {LOCAL}）
	PRINTL 　　　　 キス系コマンドに恐怖が伴うようになる
ENDIF
IF スキル >= 5
	LOCAL = 魔力消費量(5, スキル)/3
	;METALLIC MIND
	PRINTFORML 　[ 7] - メタリックマインド（魔力消費量 {LOCAL}）
	PRINTL 　　　　 実効値が低下する代わりにマイナスソースを軽減する
	;Go Berzerk
	PRINTFORML 　[ 8] - ゴー・バーサーク（魔力消費量 {LOCAL}）
	PRINTL 　　　　 欲情、恭順が大幅に上がりやすくなるが体力消費量が増える
ENDIF
IF スキル >= 6
	LOCAL = 魔力消費量(6, スキル)/3
	;Honey Party
	PRINTFORML 　[ 9] - ハニーパーティ（魔力消費量 {LOCAL}）
	PRINTL 　　　　 浴槽が媚薬ローション風呂になる
	;LUV CAN SAVE YOU
	;IF ラブキャン
		PRINTL 　[10] - ラブキャンセーブユー解除
		PRINTL 　　　　 当魔法の効果を解除する
	;ELSE
		PRINTFORML 　[10] - ラブキャンセーブユー（魔力消費量 {LOCAL}）
		PRINTL 　　　　 あらゆる絶頂に達しなくなる
	;ENDIF
ENDIF
LOCAL = 魔力消費量(7, スキル)/3
IF スキル >= 7
	;Chain of Pain
	PRINTFORML 　[11] - チェイン・オブ・ペイン（魔力消費量 {LOCAL}）
	PRINTL 　　　　 体力減少が苦痛ソースに上乗せされる
ENDIF
LOCAL = 魔力消費量(8, スキル)/3
IF スキル >= 8
	;DEADLOCK
	PRINTFORML 　[12] - デッドロック（魔力消費量 {LOCAL}）
	PRINTL 　　　　 3ターン、実行判定を無視する
ENDIF
LOCAL = 5000
IF スキル >= 10
	;終極
	PRINTFORML 　[13] - 終極（魔力消費量 {LOCAL}）
	PRINTL 　　　　 常軌を逸した恐怖、苦痛、不快を与え、即時調教を終了する 対象は30ターン使用不可になる
ENDIF

DO
	INPUT
	SELECTCASE RESULT
		CASE 1
			SIF !TALENT:魔術師
				CONTINUE
			SIF RELATION:PLAYER:(NO:TARGET) < 150 || RELATION:TARGET:(NO:PLAYER) < 150
				CONTINUE
			詠唱魔法 = 魔力吸収
			CALL KOJO_MESSAGE_COM
			;対象の魔力半減
			PRINTFORML %CALLNAME:TARGET%の魔力-{BASE:魔力-BASE:魔力/2}
			BASE:魔力 /= 2
			;PLAYERの魔力は相性に応じて貰った分だけ増加 200%でそのまま加算
			LOCAL = BASE:魔力*(LIMIT(RELATION:(NO:PLAYER)-100, 0, 100))/100
			PRINTFORML %CALLNAME:PLAYER%の魔力+{LOCAL}
			BASE:PLAYER:魔力 += LOCAL
			CALL SETBASE, PLAYER
			LOSEBASE:体力 += 5
			LOSEBASE:気力 += 50
		CASE 2
			SIF !TALENT:魔術師
				CONTINUE
			詠唱魔法 = 魔力譲与
			CALL KOJO_MESSAGE_COM
			;PLAYERの魔力半減
			PRINTFORML %CALLNAME:PLAYER%の魔力-{BASE:PLAYER:魔力-BASE:PLAYER:魔力/2}
			BASE:PLAYER:魔力 /= 2
			;魔力譲与は苦痛が伴う 相性によって効率が上がり、苦痛も軽減される
			;効率=相性-100%
			LOCAL = BASE:PLAYER:魔力*(LIMIT(RELATION:(NO:PLAYER)-100, 0, 100))/100
			PRINTFORML %CALLNAME:TARGET%の魔力+{LOCAL}
			;相性が100%以下だと最大体力の半分のダメージを受ける
			LOSEBASE:体力 += MAXBASE:体力/2/LIMIT(RELATION:(NO:PLAYER)-100, 1, 100)
		CASE 3
			詠唱魔法 = ヒートストローク
		CASE 4
			詠唱魔法 = ホワイトアウト
		CASE 5
			詠唱魔法 = リカーシブファンクション
		CASE 6
			詠唱魔法 = ニコニコサンフラワーキッス
		CASE 7
			詠唱魔法 = メタリックマインド
		CASE 8
			詠唱魔法 = ゴー・バーサーク
		CASE 9
			詠唱魔法 = ハニーパーティ
		CASE 10
			詠唱魔法 = ラブキャンセーブユー
		CASE 11
			詠唱魔法 = チェイン・オブ・ペイン
		CASE 12
			詠唱魔法 = デッドロック
		CASE 13
			詠唱魔法 = 終極
		
	ENDSELECT
LOOP 1
	


PRINTL 魔法詠唱



