;-------------------------------------------------
;野外プレイ
;-------------------------------------------------
@USERCOM_ABLE_野外プレイ, ARG
#FUNCTION
;ゲーセンに居る場合はできない
SIF TEQUIP:ゲームセンター
	RETURNF 0
;上級売春中は不可
SIF 上級売春中
	RETURNF 0
;アイテム｢首輪｣を持っていないとダメ
SIF !ITEM:首輪
	RETURNF 0
;解除はいつでも可能
IF TEQUIP:野外プレイ
	COMRESULT = 1
	RETURNF 1
ENDIF
;従順かマゾっ気が3以上ないとダメ
SIF ABL:従順 < 3 && ABL:マゾっ気 < 3
	RETURNF 0
;対象か主人か助手が種族:ヴァンパイアで、時間が昼だとダメ
IF TIME == 0
	SIF CSTR:種族 == "ヴァンパイア" || CSTR:MASTER:種族 == "ヴァンパイア" || (ASSI > 0 && CSTR:ASSI:種族 == "ヴァンパイア")
		RETURNF 0
ENDIF
;触手調教中はダメ
SIF TEQUIP:触手
	RETURNF 0
;お風呂場プレイ中はダメ
SIF TEQUIP:お風呂場
	RETURNF 0
;新妻プレイ中はダメ
SIF TEQUIP:エプロン
	RETURNF 0
;羞恥プレイ中はダメ
SIF TEQUIP:羞恥プレイ
	RETURNF 0

COMRESULT = 1
RETURNF 1

@COM_野外プレイ
PRINTL 野外プレイ
CALL KOJO_MESSAGE_COM

;着脱の処理 終了時はソース、経験の加算は行わない
INVERTBIT TEQUIP:野外プレイ, 0

;人魚で雨だと体力気力2倍
SELECTCASE FLAG:天気
	CASE 3, 4, 5
		IF CSTR:種族 == "人魚"
			IF TEQUIP:野外プレイ
				MAXBASE:体力 *= 2
				MAXBASE:気力 *= 2
				BASE:体力 *= 2
				BASE:気力 *= 2
			ELSE
				MAXBASE:体力 /= 2
				MAXBASE:気力 /= 2
				BASE:体力 /= 2
				BASE:気力 /= 2
			ENDIF
		ENDIF
ENDSELECT


SIF !TEQUIP:野外プレイ
	RETURN 1

;-------------------------------------------------
;ソース追加処理
;-------------------------------------------------
;消費体力、気力
LOSEBASE:体力 += 50
LOSEBASE:気力 += 50

SOURCE:恐怖 = 800
SOURCE:露出 = 1000
SOURCE:逸脱 = 500
SOURCE:反感 = 1500

IF SAVESTR:首輪 == "尻尾プラグ付き首輪"
	LOSEBASE:体力 += 20
	LOSEBASE:気力 += 20
	
	SOURCE:快A = 100
	SOURCE:露出 += 200
	SOURCE:反感 += 500
ENDIF

;-------------------------------------------------
;射精ゲージチェック（奴隷）
;-------------------------------------------------
SIF SAVESTR:首輪 == "尻尾プラグ付き首輪"
	LOCAL = 50

;ABL:調教者の技巧をみる
LOCAL += (LOCAL/5)*ABL:PLAYER:技巧

;ABL:欲望をみる
LOCAL += (LOCAL/10)*ABL:欲望

;PALAM:潤滑をみる
SELECTCASE GETPALAMLV(PALAM:潤滑, 4)
	CASE 0
		TIMES LOCAL , 0.20
	CASE 1
		TIMES LOCAL , 0.50
	CASE 2
		TIMES LOCAL , 1.00
	CASE 3
		TIMES LOCAL , 1.50
	CASE 4
		TIMES LOCAL , 2.50
ENDSELECT

;ABL:自慰中毒をみる
SELECTCASE ABL:自慰中毒
	CASE 0
		TIMES LOCAL , 1.00
	CASE 1
		TIMES LOCAL , 1.10
	CASE 2
		TIMES LOCAL , 1.30
	CASE 3
		TIMES LOCAL , 1.50
	CASE 4
		TIMES LOCAL , 2.00
	CASEELSE
		LOCAL += (LOCAL/3)*ABL:自慰中毒
ENDSELECT

;奴隷のABL:Ａ感覚をみる
SELECTCASE ABL:Ａ感覚
	CASE 0
		TIMES LOCAL , 0.50
	CASE 1
		TIMES LOCAL , 0.80
	CASE 2
		TIMES LOCAL , 1.00
	CASE 3
		TIMES LOCAL , 1.50
	CASE 4
		TIMES LOCAL , 2.00
	CASEELSE
		LOCAL += LOCAL*(ABL:Ａ感覚-3)
ENDSELECT

;奴隷のABL:マゾっ気をみる
LOCAL += (LOCAL/5)*ABL:マゾっ気

;奴隷が男の場合はホモっ気を見る
IF SEX(TARGET) == 1
	SELECTCASE ABL:ホモっ気
		CASE 0
			TIMES LOCAL , 0.15
		CASE 1
			TIMES LOCAL , 0.30
		CASE 2
			TIMES LOCAL , 0.50
		CASE 3
			TIMES LOCAL , 0.75
		CASE 4
			TIMES LOCAL , 1.00
		CASEELSE
			LOCAL += (LOCAL/10)*ABL:ホモっ気-3
	ENDSELECT
;女なら無条件で半減
ELSE
	TIMES LOCAL , 0.50
ENDIF

CALL 射精ゲージ増加, LOCAL, TARGET

;-------------------------------------------------
;特殊ソース処理
;-------------------------------------------------
;抑圧、抵抗持ちには、抑鬱ソース追加
SIF TALENT:抑圧 || TALENT:抵抗
	SOURCE:鬱屈 += 600

;種族で補正
SELECTCASE CSTR:種族
	CASE "獣人", "獣"
		SOURCE:露出 -= 400
ENDSELECT

;苦痛を伴わないマゾっ気及びマゾの処理は先にしておく
;マゾっ気を見る
SELECTCASE ABL:マゾっ気
	CASE 0
		TIMES SOURCE:露出 , 0.80
		SOURCE:液体 += 0
		SOURCE:欲情 += 0
	CASE 1
		TIMES SOURCE:露出 , 1.00
		SOURCE:液体 += 20
		SOURCE:欲情 += 30
	CASE 2
		TIMES SOURCE:露出 , 1.20
		SOURCE:液体 += 40
		SOURCE:欲情 += 70
	CASE 3
		TIMES SOURCE:露出 , 1.40
		SOURCE:液体 += 70
		SOURCE:欲情 += 120
	CASE 4
		TIMES SOURCE:露出 , 1.50
		SOURCE:液体 += 110
		SOURCE:欲情 += 180
	CASE 5
		TIMES SOURCE:露出 , 1.70
		SOURCE:液体 += 150
		SOURCE:欲情 += 250
	CASE 6
		TIMES SOURCE:露出 , 1.90
		SOURCE:液体 += 200
		SOURCE:欲情 += 300
	CASE 7
		TIMES SOURCE:露出 , 2.10
		SOURCE:液体 += 250
		SOURCE:欲情 += 350
	CASE 8
		TIMES SOURCE:露出 , 2.30
		SOURCE:液体 += 300
		SOURCE:欲情 += 400
	CASE 9
		TIMES SOURCE:露出 , 2.50
		SOURCE:液体 += 350
		SOURCE:欲情 += 450
	CASE IS >= 10
		TIMES SOURCE:露出 , 3.00
		SOURCE:液体 += 500
		SOURCE:欲情 += 500
ENDSELECT

;-------------------------------------------------
;絶頂チェック
;-------------------------------------------------
CALL SOURCE_CHECK_CVAB

;-------------------------------------------------
;射精チェック
;-------------------------------------------------
CALL SAMEN_CHECK_T, 0

CALL SAMEN_SHOOT_T, 0, NOWEX:射精

;実績:陥落済みのポチコと散歩する
IF CHARANAMEF(TARGET) == "ポチコ" && CFLAG:陥落
	CALL 実績解除, "「今さら首輪付けるなんて！逃げたりしないです♥」"
	;実績:気温5℃以下の日に全裸でポチコと散歩する
	SIF FLAG:気温 <= 50 && TEQUIP:MASTER:特殊 == 0 && TEQUIP:MASTER:上半身上着 == 0 && TEQUIP:MASTER:下半身上着 == 0 && TEQUIP:MASTER:上半身下着 == 0 && TEQUIP:MASTER:下半身下着 == 0 && TEQUIP:MASTER:足元 == 0
		CALL 実績解除, "「ご主人！？それは自殺行為です！」"
ENDIF

RETURN 1

;-------------------------------------------------
;装着継続の処理
;-------------------------------------------------
@EQUIP_COM_野外プレイ
PRINTL ＜野外プレイ中＞

LOSEBASE:体力 += 20
LOSEBASE:気力 += 50

SOURCE:恐怖 += 500
SOURCE:露出 += 300
SOURCE:逸脱 += 800
SOURCE:反感 += 800

IF SAVESTR:首輪 == "尻尾プラグ付き首輪"
	LOSEBASE:体力 += 20
	
	SOURCE:快A += 50
	SOURCE:露出 += 200
	SOURCE:反感 += 200
ENDIF

;-------------------------------------------------
;射精ゲージチェック（奴隷）
;-------------------------------------------------
SIF SAVESTR:首輪 == "尻尾プラグ付き首輪"
	LOCAL = 30

;ABL:欲望をみる
LOCAL += (LOCAL/10)*ABL:欲望

;PALAM:潤滑をみる
SELECTCASE GETPALAMLV(PALAM:潤滑, 4)
	CASE 0
		TIMES LOCAL , 0.20
	CASE 1
		TIMES LOCAL , 0.50
	CASE 2
		TIMES LOCAL , 1.00
	CASE 3
		TIMES LOCAL , 1.50
	CASE 4
		TIMES LOCAL , 2.50
ENDSELECT

;ABL:自慰中毒をみる
SELECTCASE ABL:自慰中毒
	CASE 0
		TIMES LOCAL , 1.00
	CASE 1
		TIMES LOCAL , 1.10
	CASE 2
		TIMES LOCAL , 1.30
	CASE 3
		TIMES LOCAL , 1.50
	CASE 4
		TIMES LOCAL , 2.00
	CASEELSE
		LOCAL += (LOCAL/3)*ABL:自慰中毒
ENDSELECT

;奴隷のABL:Ａ感覚をみる
SELECTCASE ABL:Ａ感覚
	CASE 0
		TIMES LOCAL , 0.50
	CASE 1
		TIMES LOCAL , 0.80
	CASE 2
		TIMES LOCAL , 1.00
	CASE 3
		TIMES LOCAL , 1.50
	CASE 4
		TIMES LOCAL , 2.00
	CASEELSE
		LOCAL += LOCAL*(ABL:Ａ感覚-3)
ENDSELECT

;奴隷のABL:マゾっ気をみる
LOCAL += (LOCAL/5)*ABL:マゾっ気

;奴隷が男の場合はホモっ気を見る
IF SEX(TARGET) == 1
	SELECTCASE ABL:ホモっ気
		CASE 0
			TIMES LOCAL , 0.15
		CASE 1
			TIMES LOCAL , 0.30
		CASE 2
			TIMES LOCAL , 0.50
		CASE 3
			TIMES LOCAL , 0.75
		CASE 4
			TIMES LOCAL , 1.00
		CASEELSE
			LOCAL += (LOCAL/10)*ABL:ホモっ気-3
	ENDSELECT
;女なら無条件で半減
ELSE
	TIMES LOCAL , 0.50
ENDIF

CALL 射精ゲージ増加, LOCAL, TARGET

;-------------------------------------------------
;特殊ソース処理
;-------------------------------------------------
;抑圧、抵抗持ちには、抑鬱ソース追加
SIF TALENT:抑圧 || TALENT:抵抗
	SOURCE:鬱屈 += 700

;苦痛を伴わないマゾっ気及びマゾの処理は先にしておく
;マゾっ気を見る
LOCAL = 2000

;種族で補正
SELECTCASE CSTR:種族
	CASE "獣人", "獣"
		LOCAL -= 1000
	;人魚で雨だと消費を抑えられる
	CASE "人魚"
		SELECTCASE FLAG:天気
			CASE 3, 4, 5
				LOSEBASE:体力 -= 20
				LOSEBASE:気力 -= 50
				SOURCE:恐怖 -= 400
				SOURCE:逸脱 -= 700
				SOURCE:反感 -= 700
		ENDSELECT
ENDSELECT

SELECTCASE ABL:マゾっ気
	CASE 0
		TIMES LOCAL , 0.80
		SOURCE:液体 += 0
		SOURCE:欲情 += 0
	CASE 1
		TIMES LOCAL , 1.00
		SOURCE:液体 += 20
		SOURCE:欲情 += 30
	CASE 2
		TIMES LOCAL , 1.20
		SOURCE:液体 += 40
		SOURCE:欲情 += 70
	CASE 3
		TIMES LOCAL , 1.40
		SOURCE:液体 += 70
		SOURCE:欲情 += 120
	CASE 4
		TIMES LOCAL , 1.50
		SOURCE:液体 += 110
		SOURCE:欲情 += 180
	CASE 5
		TIMES LOCAL , 1.70
		SOURCE:液体 += 150
		SOURCE:欲情 += 250
	CASE 6
		TIMES LOCAL , 1.90
		SOURCE:液体 += 200
		SOURCE:欲情 += 300
	CASE 7
		TIMES LOCAL , 2.10
		SOURCE:液体 += 250
		SOURCE:欲情 += 350
	CASE 8
		TIMES LOCAL , 2.30
		SOURCE:液体 += 300
		SOURCE:欲情 += 400
	CASE 9
		TIMES LOCAL , 2.50
		SOURCE:液体 += 350
		SOURCE:欲情 += 450
	CASE IS >= 10
		TIMES LOCAL , 3.00
		SOURCE:液体 += 500
		SOURCE:欲情 += 500
ENDSELECT
SOURCE:露出 += LOCAL

;依存度補正値(服従で1、隷属で2 強制変更なのでリセット）
IF TALENT:服従
	TFLAG:依存度補正 = 1
ELSEIF TALENT:隷属
	TFLAG:依存度補正 = 2
ENDIF

RETURN 1

